<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"holdustogether.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="JUC">
<meta property="og:type" content="article">
<meta property="og:title" content="JUC">
<meta property="og:url" content="https://holdustogether.github.io/2022/09/01/JUC/index.html">
<meta property="og:site_name" content="南北橘子">
<meta property="og:description" content="JUC">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825150714014.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825150733923.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825152200251.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825154647229.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825154804449.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825160633562.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825161134185.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825161450735.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825161818811.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825163113360.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825163219022.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825164114057.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825163723043.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825165424914.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825165453774.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825165551728.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825165953337.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825194325146.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825170517236.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825191706980.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825192418373.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825192434491.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825192450508.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825192504498.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825192520642.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825193847816.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825193931187.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825193316371.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825193347077.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825192712870.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825192747897.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825201243619.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825202020706.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825202404102.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825210124349.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825210636173.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825210914165.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825212031737.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825212723789.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825212826045.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825212928805.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825213047895.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825213505085.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826092842804.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825215023006.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825215039128.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220825215101205.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825215113043.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825215129469.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825215153476.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826100632311.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826104623218.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826105013411.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826110530194.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826115305754.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826112226546.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826115144003.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826114654120.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826113525615.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826112837373.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826113011484.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826113254434.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826113139239.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826114007540.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826113210241.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826114940379.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826115339617.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826142212198.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826142236947.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826145642488.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826151100687.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826153237774.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826153342401.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826153027824.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826153102537.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826153700629.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826154010516.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826154025734.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826154044609.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826154120285.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826154702722.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826154953365.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826155153454.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826155232539.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826155248963.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826155510110.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826155728301.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826155943764.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826160136113.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826160527607.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826160740536.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826161410194.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826161759586.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826162556697.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826162948005.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826162618897.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826162637768.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826162651360.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826163129737.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826163411187.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826163209070.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826163242657.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826164613917.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826164622020.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826164628446.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826164949724.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826165525001.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826165547511.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826165713631.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826170838931.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826171327567.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826173727926.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826173515748.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826174248152.png">
<meta property="og:image" content="https://holdustogether.github.io/typora-user-images%5Cimage-20220826174307398.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826174623421.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826174651434.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826174711055.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826174734826.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826174748174.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826174812143.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826174836535.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826175007990.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826180058867.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826180230264.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826180348567.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826180412869.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220826180510564.png">
<meta property="article:published_time" content="2022-09-01T04:42:54.699Z">
<meta property="article:modified_time" content="2022-09-21T02:33:09.208Z">
<meta property="article:author" content="wFei">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="JUC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://holdustogether.github.io/2022/09/01/JUC/image-20220825150714014.png">

<link rel="canonical" href="https://holdustogether.github.io/2022/09/01/JUC/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>JUC | 南北橘子</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="南北橘子" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/holdustogether" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">南北橘子</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://holdustogether.github.io/2022/09/01/JUC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wFei">
      <meta itemprop="description" content="不要停止成为更好的自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="南北橘子">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          JUC
        </h1>

        <div class="post-meta">
	  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-01 12:42:54" itemprop="dateCreated datePublished" datetime="2022-09-01T12:42:54+08:00">2022-09-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-09-21 10:33:09" itemprop="dateModified" datetime="2022-09-21T10:33:09+08:00">2022-09-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/JUC/" itemprop="url" rel="index"><span itemprop="name">JUC</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="JUC"><a href="#JUC" class="headerlink" title="JUC"></a>JUC</h1><span id="more"></span>

<h2 id="进程与线程"><a href="#进程与线程" class="headerlink" title="进程与线程"></a>进程与线程</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>（进程）</p>
<p>1.当一个程序被运行，从磁盘加载这个程序的代码到内存，这是就开启了一个进程。</p>
<p>2.进程可以视为程序的一个实例；大部门程序可以同时运行多个实例进程，也有的程序只能启动一个实例进程。</p>
<p>（线程）</p>
<p>1.一个进程可以分为一道多个线程。</p>
<p>2.一个线程就是一个指令流。</p>
<p>3.线程作为最小调度单位，进程作为资源分配最小单位。</p>
<p>（区别）</p>
<p>1.进程基本相互独立，而线程存于进程之中，是进程的一个子集。</p>
<p>2.进程拥有共享的资源，供其内部的线程共享。</p>
<p>3.进程间通信较为复杂，线程间相对简单，线程上下文切换成本一般要比进程上下文切换低。</p>
<p>（并发并行）</p>
<p>1.线程轮流使用cpu的做法称为并发。</p>
<p>2.多核cpu下，每个核都可以调度运行线程称为并行。</p>
<p>3.并发时是同一时间应对多件事情的能力</p>
<p>4.并行时是同一时间做多件事情的能力</p>
<h2 id="Java线程"><a href="#Java线程" class="headerlink" title="Java线程"></a>Java线程</h2><h3 id="创建线程的方式"><a href="#创建线程的方式" class="headerlink" title="创建线程的方式"></a>创建线程的方式</h3><p>1.继承Thread类</p>
<p>Thread t1 &#x3D; new Thread（）{</p>
<p>public void run（）{</p>
<p>&#x2F;&#x2F;执行的任务</p>
<p>}</p>
<p>} ；</p>
<p>t1.start（）；</p>
<img src="/2022/09/01/JUC/image-20220825150714014.png" alt="image-20220825150714014" style="zoom:50%;">

<p>2.实现Runnable接口</p>
<p>Runnable runnable &#x3D; new Runnable（）{</p>
<p>public void run（）{</p>
<p>&#x2F;&#x2F;执行的任务</p>
<p>}</p>
<p>}；</p>
<p>Thread t &#x3D; new Thread（runnable）；</p>
<p>t.start（）；</p>
<img src="/2022/09/01/JUC/image-20220825150733923.png" alt="image-20220825150733923" style="zoom:50%;">

<p>3.实现Callable接口(需要借助FutureTask类)</p>
<p>FutureTask<Integer> task &#x3D; new FutureTask&lt;&gt;(() -&gt;{</Integer></p>
<p>&#x2F;&#x2F;执行的任务</p>
<p>return 100；</p>
<p>})；</p>
<p>new Theard（task）.start（）；</p>
<p>Integer result &#x3D; task.get（）；</p>
<p><img src="/typora-user-images%5Cimage-20220825152200251.png" alt="image-20220825152200251"></p>
<p>使用Runnable和Callable的区别</p>
<p>1.Runnable重写的是run()方法，Callable重写的是call（）方法。</p>
<p>2.Callable能够抛出exception，而Runnable不可以。</p>
<p>3.Callable能得到返回结果，而Runnable不可以。</p>
<p>4.线程池方式</p>
<h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h3><p>1.start()；启动一个新线程 </p>
<p>2.run();新线程启动后调用的方法</p>
<p>3.join();等待线程运行结束</p>
<p>4.join(long n);最多等待n毫秒</p>
<p>5.getId();获取线程长整型Id</p>
<p>6.getName();获取线程名</p>
<p>7.setName(String);修改线程名</p>
<p>8.getPriority();获取线程优先级</p>
<p>9.setPriority(int);修改线程优先级</p>
<p>10.getState();获取线程状态</p>
<p>11.isInterrupted();判断是否被打断（不会清楚打断标记）</p>
<p>12.isAlive();判断是否存活</p>
<p>13.interrupt();打断线程</p>
<p>14.interrupted();判断是否被打断（清除打断标记）</p>
<p>15.currentTread();获取当前线程</p>
<p>16.sellp(long n);休眠n毫秒</p>
<p>17.yield();让出当前线程对cpu的使用</p>
<p>18.stop();停止线程运行</p>
<p>19.suspend();挂起线程</p>
<p>20.resume();恢复线程运行</p>
<p><img src="/typora-user-images%5Cimage-20220825154647229.png" alt="image-20220825154647229"></p>
<p><img src="/typora-user-images%5Cimage-20220825154804449.png" alt="image-20220825154804449"></p>
<p>有三个线程T1,T2,T3,如何保证顺序执行</p>
<p>使用线程类里的join()方法在一个线程中启动另一个线程，另外一个线程完成后该线程继续执行。</p>
<p><img src="/typora-user-images%5Cimage-20220825160633562.png" alt="image-20220825160633562"></p>
<h3 id="两阶段终止之interrupt（如何在T1优雅的终止线程T2）"><a href="#两阶段终止之interrupt（如何在T1优雅的终止线程T2）" class="headerlink" title="两阶段终止之interrupt（如何在T1优雅的终止线程T2）"></a>两阶段终止之interrupt（如何在T1优雅的终止线程T2）</h3><p><img src="/typora-user-images%5Cimage-20220825161134185.png" alt="image-20220825161134185"></p>
<img src="/2022/09/01/JUC/image-20220825161450735.png" alt="image-20220825161450735" style="zoom: 80%;">

<p>睡眠中被打断 打断标记会被置为假，所以需要重新设置打断标记</p>
<p><img src="/typora-user-images%5Cimage-20220825161818811.png" alt="image-20220825161818811"></p>
<h3 id="主线程与守护线程"><a href="#主线程与守护线程" class="headerlink" title="主线程与守护线程"></a>主线程与守护线程</h3><p>默认情况下，Java进程需要等待所有线程运行结束后才会结束，但有一种特殊的线程叫做守护线程，只要其他的非守护线程都运行结束了，即使守护线程没有执行完，也会强制结束。</p>
<h3 id="线程的状态"><a href="#线程的状态" class="headerlink" title="线程的状态"></a>线程的状态</h3><p>（操作系统层面  - 5种）</p>
<p>1.初始状态，仅是创建了线程对象，未与操作系统线程关联</p>
<p>2.可运行状态（就绪状态），指线程已经被创建，与操作系统线程关联，可由CPU调度执行</p>
<p>3.运行状态，之线程获取CPU时间片运行中的状态</p>
<p>当CPU时间片用完会从运行状态变为可运行状态导致线程上下文切换。</p>
<p>4.阻塞状态，如果调用阻塞API，如读写文件，这时线程实际不会用到CPU，会导致线程上下文切换，进入阻塞状态</p>
<p>操作执行完，操作系统会唤醒阻塞线程，转换为可运行状态</p>
<p>对于阻塞状态，只要一直不唤醒它们，调度器就一直不会考虑调度它们</p>
<p>5.终止状态，表示线程执行完毕，生命周期结束</p>
<img src="/2022/09/01/JUC/image-20220825163113360.png" alt="image-20220825163113360" style="zoom:50%;">

<p>（Java API层面  -6种）</p>
<img src="/2022/09/01/JUC/image-20220825163219022.png" alt="image-20220825163219022" style="zoom:50%;">

<ul>
<li><p>new -&gt; runnable</p>
<ul>
<li>调用t.start()方法时，new –&gt;runnable</li>
</ul>
</li>
<li><p>runnable &lt;—&gt; waiting</p>
<ul>
<li>t线程用synchronized获取对象锁后<ul>
<li>调用wait()方法时，runnable –&gt; waiting</li>
<li>调用notify()&#x2F;notifyAll()&#x2F;interrupt()方法时,竞争成功waiting–&gt;runnable，竞争失败waiting–&gt;blocked</li>
</ul>
</li>
<li>当前线程调用t.join()方法时<ul>
<li>当前线程从runnable –&gt; waiting</li>
<li>t线程运行结束，或调用当前线程的interrupt()时，waiting –&gt; runnable</li>
</ul>
</li>
<li>当前线程调用LockSupport.park()方法时<ul>
<li>当前线程runnable –&gt; waiting</li>
<li>调用LockSupport.Unpark()，或调用当前线程interrupt()，waiting –&gt; runnable</li>
</ul>
</li>
</ul>
</li>
<li><p>runnable &lt;—&gt; Timed waiting</p>
<ul>
<li>当前线程调用Thread.sleep(long n)，当前线程从runnable –&gt; Timed waiting,等待超过n毫秒，从Timed waiting–&gt; runnable</li>
<li>其他与runnable &lt;—&gt;waiting相同，只是规定了等待时间</li>
</ul>
</li>
<li><p>runnable &lt;—&gt; blocked</p>
<ul>
<li><p>t线程使用synchronized获取对象锁竞争失败</p>
</li>
<li><p>持 obj 锁线程的同步代码块执行完毕，会唤醒该对象上所有 BLOCKED 的线程重新竞争，如果其中 t线程竞争</p>
<p>成功，从 BLOCKED –&gt; RUNNABLE ，其它失败的线程仍然 BLOCKED</p>
</li>
</ul>
</li>
<li><p>runnable -&gt; terminated</p>
<ul>
<li>当前线程所有代码运行完毕</li>
</ul>
</li>
</ul>
<h2 id="悲观锁"><a href="#悲观锁" class="headerlink" title="悲观锁"></a>悲观锁</h2><h3 id="线程安全问题"><a href="#线程安全问题" class="headerlink" title="线程安全问题"></a>线程安全问题</h3><p>线程安全是指在拥有共享数据的多线程并行执行的程序中，线程安全的代码会保证各个宣称都可以正常且正确的执行，不会出现数据污染的意外情况。</p>
<p><img src="/typora-user-images%5Cimage-20220825164114057.png"></p>
<p><img src="/typora-user-images%5Cimage-20220825163723043.png" alt="image-20220825163723043"></p>
<h3 id="重量级锁synchronized"><a href="#重量级锁synchronized" class="headerlink" title="重量级锁synchronized"></a>重量级锁synchronized</h3><img src="/2022/09/01/JUC/image-20220825165424914.png" alt="image-20220825165424914" style="zoom:50%;">

<p><img src="/2022/09/01/JUC/image-20220825165453774.png" alt="image-20220825165453774" style="zoom:50%;"><img src="/2022/09/01/JUC/image-20220825165551728.png" alt="image-20220825165551728" style="zoom: 50%;"></p>
<p>（原理）Java对象头</p>
<img src="/2022/09/01/JUC/image-20220825165953337.png" alt="image-20220825165953337" style="zoom:50%;">

<img src="/2022/09/01/JUC/image-20220825194325146.png" alt="image-20220825194325146" style="zoom: 67%;">

<p>Monitor结构</p>
<p>每一个对象都可以关联一个Monitor对象，如果使用synchronized给对象上锁（重量级），该对象的对象头中的Mark Word中就被设置为指向Monitor对象的指针</p>
<p><img src="/typora-user-images%5Cimage-20220825170517236.png" alt="image-20220825170517236"></p>
<p>刚开始 Monitor 中 Owner 为 null</p>
<p>当 Thread-2 执行 synchronized(obj) 就会将 Monitor 的所有者 Owner 置为 Thread-2，Monitor中只能有一</p>
<p>个 Owner</p>
<p>在 Thread-2 上锁的过程中，如果 Thread-3，Thread-4，Thread-5 也来执行 synchronized(obj)，就会进入</p>
<p>EntryList BLOCKED</p>
<p>Thread-2 执行完同步代码块的内容，然后唤醒 EntryList 中等待的线程来竞争锁，竞争的时是非公平的</p>
<p>图中 WaitSet 中的 Thread-0，Thread-1 是之前获得过锁，但条件不满足进入 WAITING 状态的线程，后面讲</p>
<p>wait-notify 时会分析</p>
<h4 id="锁优化"><a href="#锁优化" class="headerlink" title="锁优化"></a>锁优化</h4><p>1.轻量级锁</p>
<p>如果一个对象有多线程要加锁，但加锁的时间是错开的（也就是没有竞争），便可以使用轻量级锁来优化</p>
<p><img src="/typora-user-images%5Cimage-20220825191706980.png" alt="image-20220825191706980"></p>
<p>创建锁记录（Lock Record）对象，每个线程都的栈帧都会包含一个锁记录的结构，内部可以存储锁定对象的</p>
<p>Mark Word</p>
<img src="/2022/09/01/JUC/image-20220825192418373.png" alt="image-20220825192418373" style="zoom:50%;">

<p>让锁记录中 Object reference 指向锁对象，并尝试用 cas 替换 Object 的 Mark Word，将 Mark Word 的值存</p>
<p>入锁记录</p>
<img src="/2022/09/01/JUC/image-20220825192434491.png" alt="image-20220825192434491" style="zoom:50%;">

<p>如果 cas 替换成功，对象头中存储了 锁记录地址和状态 00 ，表示由该线程给对象加锁，这时图示如下</p>
<img src="/2022/09/01/JUC/image-20220825192450508.png" alt="image-20220825192450508" style="zoom:50%;">

<p>如果 cas 失败，有两种情况</p>
<p>如果是其它线程已经持有了该 Object 的轻量级锁，这时表明有竞争，进入锁膨胀过程</p>
<p>如果是自己执行了 synchronized 锁重入，那么再添加一条 Lock Record 作为重入的计数</p>
<img src="/2022/09/01/JUC/image-20220825192504498.png" alt="image-20220825192504498" style="zoom:50%;">

<p>当退出 synchronized 代码块（解锁时）如果有取值为 null 的锁记录，表示有重入，这时重置锁记录，表示重</p>
<p>入计数减一</p>
<img src="/2022/09/01/JUC/image-20220825192520642.png" alt="image-20220825192520642" style="zoom:50%;">

<p>当退出 synchronized 代码块（解锁时）锁记录的值不为 null，这时使用 cas 将 Mark Word 的值恢复给对象</p>
<p>头</p>
<p>成功，则解锁成功</p>
<p>失败，说明轻量级锁进行了锁膨胀或已经升级为重量级锁，进入重量级锁解锁流程</p>
<p>2.偏向锁：轻量级锁在没有竞争时（就自己这个线程），每次重入仍然需要执行 CAS 操作。</p>
<p>Java 6 中引入了偏向锁来做进一步优化：只有第一次使用 CAS 将线程 ID 设置到对象的 Mark Word 头，之后发现</p>
<p>这个线程 ID 是自己的就表示没有竞争，不用重新 CAS。以后只要不发生竞争，这个对象就归该线程所有</p>
<img src="/2022/09/01/JUC/image-20220825193847816.png" alt="image-20220825193847816" style="zoom:50%;">

<p><img src="/typora-user-images%5Cimage-20220825193931187.png" alt="image-20220825193931187"></p>
<p>一个对象创建时：</p>
<p>如果开启了偏向锁（默认开启），那么对象创建后，markword 值为 0x05 即最后 3 位为 101，这时它的</p>
<p>thread、epoch、age 都为 0</p>
<p>撤销偏向锁—调用对象hashcode</p>
<p>调用了对象的 hashCode，但偏向锁的对象 MarkWord 中存储的是线程 id，如果调用 hashCode 会导致偏向锁被</p>
<p>撤销</p>
<p>轻量级锁会在锁记录中记录 hashCode</p>
<p>重量级锁会在 Monitor 中记录 hashCode</p>
<p>撤销偏向锁—调用其他线程</p>
<p>当有其它线程使用偏向锁对象时，会将偏向锁升级为轻量级锁</p>
<p>撤销偏向锁—调用wait&#x2F;notify</p>
<p>3.自旋 ： 让线程进入一种忙循环</p>
<p><img src="/2022/09/01/JUC/image-20220825193316371.png" alt="image-20220825193316371" style="zoom: 33%;"><img src="/2022/09/01/JUC/image-20220825193347077.png" alt="image-20220825193347077" style="zoom:33%;"></p>
<p>4.自适应自旋：自旋的时间不是固定时间，而是由前一次在同一个锁上的自旋时间和锁的持有者的状态决定</p>
<p>5.锁消除：是指JVM检测到一些同步的代码块，完全不存在数据竞争的场景，也就是完全不需要加锁，就会进行锁消除</p>
<p>6.锁粗化：是指很多操作都是对同一个对象加锁，就会把锁的同步范围扩展到整个操作序列之外</p>
<h4 id="锁膨胀"><a href="#锁膨胀" class="headerlink" title="锁膨胀"></a>锁膨胀</h4><p>如果在尝试加轻量级锁的过程中，CAS 操作无法成功，这时一种情况就是有其它线程为此对象加上了轻量级锁（有</p>
<p>竞争），这时需要进行锁膨胀，将轻量级锁变为重量级锁。</p>
<p>当 Thread-1 进行轻量级加锁时，Thread-0 已经对该对象加了轻量级锁</p>
<img src="/2022/09/01/JUC/image-20220825192712870.png" alt="image-20220825192712870" style="zoom:50%;">

<p>这时 Thread-1 加轻量级锁失败，进入锁膨胀流程</p>
<p>即为 Object 对象申请 Monitor 锁，让 Object 指向重量级锁地址，然后自己进入 Monitor 的 EntryList BLOCKED</p>
<img src="/2022/09/01/JUC/image-20220825192747897.png" alt="image-20220825192747897" style="zoom:50%;">

<p>当 Thread-0 退出同步块解锁时，使用 cas 将 Mark Word 的值恢复给对象头，失败。这时会进入重量级解锁</p>
<p>流程，即按照 Monitor 地址找到 Monitor 对象，设置 Owner 为 null，唤醒 EntryList 中 BLOCKED 线程</p>
<h3 id="wait-notify"><a href="#wait-notify" class="headerlink" title="wait - notify"></a>wait - notify</h3><p>sleep（）和wait（）的区别</p>
<p>1.sleep是属于Thread类中，wait属于Object类中</p>
<p>2.sleep不需要强制和synchronized配合使用，wait需要</p>
<p>3.sleep在睡眠时不会释放锁对象，wait会释放锁对象</p>
<p>notify 只能随机唤醒一个 WaitSet 中的线程，这时如果有其它线程也在等待，那么就可能唤醒不了正确的线</p>
<p>程，称之为【虚假唤醒】</p>
<p>原理</p>
<img src="/2022/09/01/JUC/image-20220825201243619.png" alt="image-20220825201243619" style="zoom: 67%;">

<p>Owner 线程中的Thread-2在运行时发现条件不满足，会调用 wait 方法，即可进入 WaitSet 变为 WAITING 状态</p>
<p>BLOCKED 和 WAITING 的线程都处于阻塞状态，不占用 CPU 时间片</p>
<p>BLOCKED 线程会在 Owner 线程释放锁时唤醒</p>
<p>WAITING 线程会在 Owner 线程调用 notify 或 notifyAll 时唤醒，但唤醒后并不意味者立刻获得锁，仍需进入</p>
<p>EntryList 重新竞争</p>
<h3 id="join"><a href="#join" class="headerlink" title="join"></a>join</h3><p>原理</p>
<p>判断线程是否存活，存活就一直等待</p>
<img src="/2022/09/01/JUC/image-20220825202020706.png" alt="image-20220825202020706" style="zoom:80%;">



<h3 id="Park-amp-amp-Unpark"><a href="#Park-amp-amp-Unpark" class="headerlink" title="Park&amp;&amp;Unpark"></a>Park&amp;&amp;Unpark</h3><p>基本使用</p>
<p><img src="/typora-user-images%5Cimage-20220825202404102.png" alt="image-20220825202404102"></p>
<p>原理</p>
<p>每个线程都有自己的一个 Parker 对象，由三部分组成 _counter ， _cond 和 _mutex 打个比喻</p>
<ul>
<li>线程就像一个旅人，Parker 就像他随身携带的背包，条件变量就好比背包中的帐篷。_counter 就好比背包中</li>
</ul>
<p>​     的备用干粮（0 为耗尽，1 为充足）</p>
<ul>
<li><p>调用 park 就是要看需不需要停下来歇息</p>
<ul>
<li>如果备用干粮耗尽，那么钻进帐篷歇息</li>
<li>如果备用干粮充足，那么不需停留，继续前进</li>
</ul>
</li>
<li><p>调用 unpark，就好比令干粮充足</p>
<ul>
<li>如果这时线程还在帐篷，就唤醒让他继续前进</li>
<li>如果这时线程还在运行，那么下次他调用 park 时，仅是消耗掉备用干粮，不需停留继续前进<ul>
<li>因为背包空间有限，多次调用 unpark 仅会补充一份备用干粮</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>与 Object 的 wait &amp; notify 相比</p>
<p>1.wait，notify 和 notifyAll 必须配合 Object Monitor 一起使用，而 park，unpark 不必</p>
<p>2.park &amp; unpark 是以线程为单位来【阻塞】和【唤醒】线程，而 notify 只能随机唤醒一个等待线程，notifyAll </p>
<p>是唤醒所有等待线程，就不那么【精确】</p>
<p>3.park &amp; unpark 可以先 unpark，而 wait &amp; notify 不能先 notify</p>
<h3 id="多把锁"><a href="#多把锁" class="headerlink" title="多把锁"></a>多把锁</h3><p>一个对象设置多把锁，设置不同的功能</p>
<p><img src="/typora-user-images%5Cimage-20220825210124349.png" alt="image-20220825210124349"></p>
<p>将锁的粒度细分</p>
<ul>
<li><p>好处，是可以增强并发度</p>
</li>
<li><p>坏处，如果一个线程需要同时获得多把锁，就容易发生死锁</p>
</li>
</ul>
<h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><p>有这样的情况：一个线程需要同时获取多把锁，这时就容易发生死锁</p>
<p>t1 线程 获得A对象锁，接下来想获取B对象的锁</p>
<p>t2 线程 获得B对象锁，接下来想获取A对象的锁</p>
<img src="/2022/09/01/JUC/image-20220825210636173.png" alt="image-20220825210636173" style="zoom:67%;">



<p>产生死锁的必要条件</p>
<p>1.互斥条件：一个资源每次只能被一个线程调用</p>
<p>2.请求与保持条件：一个线程因请求资源而阻塞时，对以获得的资源保持不放</p>
<p>3.不剥夺条件：进程已经获得的资源，在未使用完成之前，不能强行剥夺</p>
<p>4.循环等待条件：若干线程之间形成一种头尾相接的循环等待资源的关系</p>
<p>避免死锁</p>
<h3 id="活锁"><a href="#活锁" class="headerlink" title="活锁"></a>活锁</h3><p>活锁出现在两个线程互相改变对方的结束条件，最后谁也无法结束</p>
<img src="/2022/09/01/JUC/image-20220825210914165.png" alt="image-20220825210914165" style="zoom:80%;">

<h3 id="饥饿"><a href="#饥饿" class="headerlink" title="饥饿"></a>饥饿</h3><p>一个线程由于优先级太低，始终得不到 CPU 调度执行，也不能够结束</p>
<h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h3><p>相对于 synchronized 有什么不同</p>
<p>相同点都是加锁同步，而且都是阻塞式同步，都可重入</p>
<p>不同点</p>
<ul>
<li>对于synchronized来说，他是java语言的关键字，是原生语法层面的互斥，需要jvm实现。而ReentrantLock是API层面的互斥锁，需要lock()和unlock()方法配合try&#x2F;finally语句块完成</li>
<li>ReentrantLock功能更高级，支持可中断，可以设置超时时间，可以设置为公平锁，支持多个条件变量</li>
</ul>
<p>基本语法</p>
<img src="/2022/09/01/JUC/image-20220825212031737.png" alt="image-20220825212031737" style="zoom:50%;">

<ul>
<li><p>可打断<img src="/2022/09/01/JUC/image-20220825212723789.png" alt="image-20220825212723789" style="zoom:50%;"></p>
</li>
<li><p>设置超时时间</p>
<ul>
<li>立刻失败<img src="/2022/09/01/JUC/image-20220825212826045.png" alt="image-20220825212826045" style="zoom:50%;"></li>
<li>超时失败<img src="/2022/09/01/JUC/image-20220825212928805.png" alt="image-20220825212928805" style="zoom:50%;"></li>
</ul>
</li>
<li><p>设置公平锁（默认不公平）<img src="/2022/09/01/JUC/image-20220825213047895.png" alt="image-20220825213047895" style="zoom: 80%;"></p>
</li>
<li><p>设置条件变量（休息室）<img src="/2022/09/01/JUC/image-20220825213505085.png" alt="image-20220825213505085" style="zoom:80%;"></p>
<p>await（等待） signal&#x2F;signalAll（唤醒）</p>
<p>await 前需要获得锁</p>
<p>await 执行后，会释放锁，进入 conditionObject 等待</p>
<p>await 的线程被唤醒（或打断、或超时）取重新竞争 lock 锁</p>
<p>竞争 lock 锁成功后，从 await 后继续执行</p>
</li>
</ul>
<h2 id="Java内存模型-JMM"><a href="#Java内存模型-JMM" class="headerlink" title="Java内存模型 JMM"></a>Java内存模型 JMM</h2><h3 id="三大特性"><a href="#三大特性" class="headerlink" title="三大特性"></a>三大特性</h3><p>JMM 体现在以下几个方面</p>
<p>原子性 - 保证指令不会受到线程上下文切换的影响</p>
<p>可见性 - 保证指令不会受 cpu 缓存的影响</p>
<p>有序性 - 保证指令不会受 cpu 指令并行优化的影响</p>
<ul>
<li>对于可见性—–volatile（易变关键字）</li>
</ul>
<p>它可以用来修饰成员变量和静态成员变量，他可以避免线程从自己的工作缓存中查找变量的值，必须到主存中获取</p>
<p>它的值，线程操作 volatile 变量都是直接操作主存</p>
<ul>
<li>对于有序性—volatile 修饰的变量，可以禁用指令重排</li>
</ul>
<h3 id="两阶段终止-volatile"><a href="#两阶段终止-volatile" class="headerlink" title="两阶段终止-volatile"></a>两阶段终止-volatile</h3><img src="/2022/09/01/JUC/image-20220826092842804.png" alt="image-20220826092842804" style="zoom:80%;">

<h3 id="volatile原理"><a href="#volatile原理" class="headerlink" title="volatile原理"></a>volatile原理</h3><p>volatile 的底层实现原理是内存屏障，Memory Barrier（Memory Fence） </p>
<ul>
<li><p>对 volatile 变量的写指令后会加入写屏障</p>
</li>
<li><p>对 volatile 变量的读指令前会加入读屏障</p>
<p>可见性</p>
<ul>
<li><p>写屏障（sfence）保证在该屏障之前的 t1 对共享变量的改动，都同步到主存当中</p>
</li>
<li><p>而读屏障（lfence）保证在该屏障之后 t2 对共享变量的读取，加载的是主存中最新数据</p>
<img src="/2022/09/01/JUC/image-20220825215023006.png" alt="image-20220825215023006" style="zoom: 80%;">

<img src="/2022/09/01/JUC/image-20220825215039128.png" alt="image-20220825215039128" style="zoom:80%;">

<p><img src="/typora-user-images%5Cimage-20220825215101205.png" alt="image-20220825215101205"></p>
</li>
</ul>
<p>有序性</p>
<ul>
<li><p>写屏障会确保指令重排序时，不会将写屏障之前的代码排在写屏障之后</p>
</li>
<li><p>读屏障会确保指令重排序时，不会将读屏障之后的代码排在读屏障之前</p>
<img src="/2022/09/01/JUC/image-20220825215113043.png" alt="image-20220825215113043" style="zoom:80%;">

<img src="/2022/09/01/JUC/image-20220825215129469.png" alt="image-20220825215129469" style="zoom:80%;">

<img src="/2022/09/01/JUC/image-20220825215153476.png" alt="image-20220825215153476" style="zoom:80%;"></li>
</ul>
<p>更底层是读写变量时使用 lock 指令来多核 CPU 之间的可见性与有序性</p>
</li>
</ul>
<h2 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h2><h3 id="cas（-Compare-And-Set）"><a href="#cas（-Compare-And-Set）" class="headerlink" title="cas（ Compare And Set）"></a>cas（ Compare And Set）</h3><p><strong>cas与volatile</strong></p>
<p>获取共享变量时，为了保证该变量的可见性，需要使用 volatile 修饰。</p>
<p>它可以用来修饰成员变量和静态成员变量，他可以避免线程从自己的工作缓存中查找变量的值，必须到主存中获取</p>
<p>它的值，线程操作 volatile 变量都是直接操作主存。即一个线程对 volatile 变量的修改，对另一个线程可见。</p>
<p><strong>注意</strong></p>
<p>volatile 仅仅保证了共享变量的可见性，让其它线程能够看到最新值，但不能解决指令交错问题（不能保证原</p>
<p>子性）</p>
<p>CAS 必须借助 volatile 才能读取到共享变量的最新值来实现【比较并交换】的效果</p>
<p><strong>原理</strong></p>
<p>cas主要通过处理器的指令保证操作的原子性，包含3个操作数：1.变量内存地址，V表示  2.旧的预期值，A表示  3.准备设置的新值，B表示</p>
<p>当执行cas指令时，只有当V等于A，才会用B去更新V的值，否则不会执行更新操作。</p>
<p><strong>CAS</strong> <strong>的特点</strong></p>
<p>结合 CAS 和 volatile 可以实现无锁并发，适用于线程数少、多核 CPU 的场景下。</p>
<p>CAS 是基于乐观锁的思想：最乐观的估计，不怕别的线程来修改共享变量，就算改了也没关系，我吃亏点再</p>
<p>重试呗。</p>
<p>synchronized 是基于悲观锁的思想：最悲观的估计，得防着其它线程来修改共享变量，我上了锁你们都别想</p>
<p>改，我改完了解开锁，你们才有机会。</p>
<p>CAS 体现的是无锁并发、无阻塞并发，请仔细体会这两句话的意思</p>
<p>因为没有使用 synchronized，所以线程不会陷入阻塞，这是效率提升的因素之一</p>
<p>但如果竞争激烈，可以想到重试必然频繁发生，反而效率会受影响</p>
<p><strong>缺点</strong></p>
<p>1.对于ABA问题：主线程仅能判断出共享变量的值与最初值 A 是否相同，不能感知到这种从 A 改为 B 又 改回 A 的情况</p>
<p>如果主线程希望：</p>
<p>只要有其它线程【动过了】共享变量，那么自己的 cas 就算失败，这时，仅比较值是不够的，需要再加一个版本号</p>
<p>【AtomicStampedReference】</p>
<img src="/2022/09/01/JUC/image-20220826100632311.png" alt="image-20220826100632311" style="zoom:80%;">

<p>2.循环时间长开销大，自旋 cas的方式如果长时间不成功，会给cpu带来很大的开销</p>
<p>3.只能保证一个共享变量的原子操作</p>
<h3 id="原子整数"><a href="#原子整数" class="headerlink" title="原子整数"></a>原子整数</h3><p>AtomicBoolean</p>
<p>AtomicInteger</p>
<p>AtomicLong</p>
<p>举例：</p>
<p>AtomicInteger i &#x3D; new AtomicInteger(0);</p>
<p>i.getAndIncrement() 获取并自增</p>
<p>i.incrementAndGet() 自增并获取</p>
<p>i.decrementAndGet()自减并获取</p>
<p>i.getAndDecrement() 获取并自减</p>
<p>i.getAndAdd(5) 获取并加值</p>
<p>i.addAndGet(-5) 加值并获取</p>
<p>i.getAndUpdate(p -&gt; p - 2) 获取并更 新</p>
<p>i.updateAndGet(p -&gt; p + 2) 更新并获取</p>
<p>i.getAndAccumulate(10, (p, x) -&gt; p + x) 获取并计算</p>
<p>i.accumulateAndGet(-10, (p, x) -&gt; p + x)  计算并获取</p>
<h3 id="原子引用"><a href="#原子引用" class="headerlink" title="原子引用"></a>原子引用</h3><p>AtomicReference</p>
<p>AtomicMarkableReference</p>
<p>AtomicStampedReference</p>
<h3 id="原子数组"><a href="#原子数组" class="headerlink" title="原子数组"></a>原子数组</h3><p>AtomicIntegerArray</p>
<p>AtomicLongArray</p>
<p>AtomicReferenceArray</p>
<h3 id="字段更新器"><a href="#字段更新器" class="headerlink" title="字段更新器"></a>字段更新器</h3><p>AtomicReferenceFieldUpdater &#x2F;&#x2F; 域 字段</p>
<p>AtomicIntegerFieldUpdater</p>
<p>AtomicLongFieldUpdater</p>
<h3 id="原子累加器"><a href="#原子累加器" class="headerlink" title="原子累加器"></a>原子累加器</h3><p>AtomicLong</p>
<p>LongAdder（性能更好）</p>
<h3 id="Unsafe"><a href="#Unsafe" class="headerlink" title="Unsafe"></a>Unsafe</h3><h2 id="不可变"><a href="#不可变" class="headerlink" title="不可变"></a>不可变</h2><p><strong>final原理</strong></p>
<p>设置final变量</p>
<img src="/2022/09/01/JUC/image-20220826104623218.png" alt="image-20220826104623218" style="zoom:80%;">

<p>获取final变量</p>
<img src="/2022/09/01/JUC/image-20220826105013411.png" alt="image-20220826105013411" style="zoom:80%;">

<p>直接获取到值，而不是获取对象</p>
<h2 id="并发工具"><a href="#并发工具" class="headerlink" title="并发工具"></a>并发工具</h2><h3 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h3><h4 id="自定义线程池"><a href="#自定义线程池" class="headerlink" title="自定义线程池"></a>自定义线程池</h4><p>结构</p>
<p><img src="/typora-user-images%5Cimage-20220826110530194.png" alt="image-20220826110530194"></p>
<p>拒绝接口</p>
<img src="/2022/09/01/JUC/image-20220826115305754.png" alt="image-20220826115305754" style="zoom:80%;">

<p>线程池</p>
<img src="/2022/09/01/JUC/image-20220826112226546.png" alt="image-20220826112226546" style="zoom: 80%;">



<p>​                                                        <img src="/2022/09/01/JUC/image-20220826115144003.png" alt="image-20220826115144003" style="zoom:80%;"><img src="/2022/09/01/JUC/image-20220826114654120.png" alt="image-20220826114654120" style="zoom:80%;"></p>
<img src="/2022/09/01/JUC/image-20220826113525615.png" alt="image-20220826113525615" style="zoom:80%;">

<p>阻塞队列</p>
<img src="/2022/09/01/JUC/image-20220826112837373.png" alt="image-20220826112837373" style="zoom:80%;">



<img src="/2022/09/01/JUC/image-20220826113011484.png" alt="image-20220826113011484" style="zoom:80%;">

<img src="/2022/09/01/JUC/image-20220826113254434.png" alt="image-20220826113254434" style="zoom:80%;">

<img src="/2022/09/01/JUC/image-20220826113139239.png" alt="image-20220826113139239" style="zoom:80%;">

<img src="/2022/09/01/JUC/image-20220826114007540.png" alt="image-20220826114007540" style="zoom:80%;">

<img src="/2022/09/01/JUC/image-20220826113210241.png" alt="image-20220826113210241" style="zoom:80%;">

<img src="/2022/09/01/JUC/image-20220826114940379.png" alt="image-20220826114940379" style="zoom:80%;">

<p>测试</p>
<img src="/2022/09/01/JUC/image-20220826115339617.png" alt="image-20220826115339617" style="zoom:80%;">

<h4 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h4><p><strong>线程池状态</strong></p>
<img src="/2022/09/01/JUC/image-20220826142212198.png" alt="image-20220826142212198" style="zoom:80%;">

<p><strong>构造方法</strong></p>
<img src="/2022/09/01/JUC/image-20220826142236947.png" alt="image-20220826142236947" style="zoom:80%;">

<p><strong>jdk提供的四种拒绝策略</strong></p>
<ul>
<li><p>AbortPolicy让调用者抛出 RejectedExecutionException 异常，这是默认策略</p>
</li>
<li><p>CallerRunsPolicy 让调用者运行任务</p>
</li>
<li><p>DiscardPolicy 放弃本次任务</p>
</li>
<li><p>DiscardOldestPolicy 放弃队列中最早的任务，本任务取而代之</p>
<p><strong>其他框架提供的策略</strong></p>
</li>
<li><p>Dubbo 的实现，在抛出 RejectedExecutionException 异常之前会记录日志，并 dump 线程栈信息，方</p>
<p>便定位问题</p>
</li>
<li><p>Netty 的实现，是创建一个新线程来执行任务</p>
</li>
<li><p>ActiveMQ 的实现，带超时等待（60s）尝试放入队列，类似我们之前自定义的拒绝策略</p>
</li>
<li><p>PinPoint 的实现，它使用了一个拒绝策略链，会逐一尝试策略链中每种拒绝策略</p>
</li>
</ul>
<p><strong>工厂方法创建常用线程池</strong></p>
<p>1.newSingleThreadExecutor：创建一个单线程的线程池，保证所有任务的执行顺序按任务的提交顺序执行</p>
<p>2.newFixedThreadPool：创建固定大小的线程池，每次提交一个任务就创建一个线程，直到线程达到线程池的最大大小</p>
<ul>
<li>核心线程数 &#x3D;&#x3D; 最大线程数（没有救急线程被创建），因此也无需超时时间</li>
<li>阻塞队列是无界的，可以放任意数量的任务</li>
</ul>
<p>3.newCachedThreadPool：创建一个可缓存的线程池，此线程池不会对线程的大小做限制，线程池大大小完全依赖于操作系统能够创建的最大线程大小</p>
<ul>
<li>核心线程数是 0， </li>
<li>最大线程数是 Integer.MAX_VALUE，救急线程的空闲生存时间是 60s，</li>
<li>意味着全部都是救急线程（60s 后可以回收）</li>
<li>救急线程可以无限创建</li>
</ul>
<p>4.newScheduledThreadPool：任务调度线程池，支持定时已经周期性执行任务的需求</p>
<p><strong>线程池的提交</strong></p>
<p>&#x2F;&#x2F; 执行任务</p>
<p>void execute(Runnable command);</p>
<p>&#x2F;&#x2F; 提交任务 task，用返回值 Future 获得任务执行结果</p>
<p><T> Future<T> submit(Callable<T> task);</T></T></T></p>
<p>&#x2F;&#x2F; 提交 tasks 中所有任务</p>
<p><T> List&lt;Future<T>&gt; invokeAll(Collection&lt;? extends Callable<T>&gt; tasks)</T></T></T></p>
<p> throws InterruptedException;</p>
<p>&#x2F;&#x2F; 提交 tasks 中所有任务，带超时时间</p>
<p><T> List&lt;Future<T>&gt; invokeAll(Collection&lt;? extends Callable<T>&gt; tasks,</T></T></T></p>
<p> long timeout, TimeUnit unit) throws InterruptedException;</p>
<p>&#x2F;&#x2F; 提交 tasks 中所有任务，哪个任务先成功执行完毕，返回此任务执行结果，其它任务取消</p>
<p><T> T invokeAny(Collection&lt;? extends Callable<T>&gt; tasks) throws InterruptedException, ExecutionException;</T></T></p>
<p>&#x2F;&#x2F; 提交 tasks 中所有任务，哪个任务先成功执行完毕，返回此任务执行结果，其它任务取消，带超时时间</p>
<p><T> T invokeAny(Collection&lt;? extends Callable<T>&gt; tasks,</T></T></p>
<p> long timeout, TimeUnit unit)throws InterruptedException, ExecutionException, TimeoutException;</p>
<p><img src="/typora-user-images%5Cimage-20220826145642488.png" alt="image-20220826145642488"></p>
<p><strong>关闭线程池</strong></p>
<p>shutdown</p>
<p>线程池状态变为 SHUTDOWN</p>
<p>- 不会接收新任务</p>
<p>- 但已提交任务会执行完</p>
<p>- 此方法不会阻塞调用线程的执行</p>
<p>shutdownNow</p>
<p>线程池状态变为 STOP</p>
<p>- 不会接收新任务</p>
<p>- 会将队列中的任务返回</p>
<p>- 并用 interrupt 的方式中断正在执行的任务</p>
<p>使用线程池的好处</p>
<p>1.降低资源消耗</p>
<p>2.提高响应速度</p>
<p>3.提高线程可管理性</p>
<h4 id="Fork-x2F-join"><a href="#Fork-x2F-join" class="headerlink" title="Fork&#x2F;join"></a>Fork&#x2F;join</h4><p>Fork&#x2F;Join 是 JDK 1.7 加入的新的线程池实现，它体现的是一种分治思想，适用于能够进行任务拆分的 cpu 密集型</p>
<p>运算</p>
<p>所谓的任务拆分，是将一个大任务拆分为算法上相同的小任务，直至不能拆分可以直接求解。</p>
<p>Fork&#x2F;Join 在分治的基础上加入了多线程，可以把每个任务的分解和合并交给不同的线程来完成，进一步提升了运</p>
<p>算效率</p>
<p>Fork&#x2F;Join 默认会创建与 cpu 核心数大小相同的线程池</p>
<p>提交给 Fork&#x2F;Join 线程池的任务需要继承 RecursiveTask（有返回值）或 RecursiveAction（没有返回值）</p>
<p>例如<img src="/2022/09/01/JUC/image-20220826151100687.png" alt="image-20220826151100687" style="zoom:50%;"></p>
<h3 id="JUC原理"><a href="#JUC原理" class="headerlink" title="JUC原理"></a>JUC原理</h3><h4 id="aqs原理"><a href="#aqs原理" class="headerlink" title="aqs原理"></a>aqs原理</h4><p>全称是 AbstractQueuedSynchronizer，是阻塞式锁和相关的同步器工具的框架</p>
<p>特点</p>
<ul>
<li>用 state 属性来表示资源的状态（分独占模式和共享模式），子类需要定义如何维护这个状态，控制如何获取</li>
</ul>
<p>锁和释放锁</p>
<ul>
<li><p>getState - 获取 state 状态</p>
</li>
<li><p>setState - 设置 state 状态</p>
</li>
<li><p>compareAndSetState - cas 机制设置 state 状态</p>
</li>
<li><p>独占模式是只有一个线程能够访问资源，而共享模式可以允许多个线程访问资源</p>
</li>
<li><p>提供了基于 FIFO 的等待队列，类似于 Monitor 的 EntryList</p>
</li>
<li><p>条件变量来实现等待、唤醒机制，支持多个条件变量</p>
</li>
</ul>
<p><strong>实现</strong></p>
<p>子类继承aqs并实现一些方法（默认抛出 UnsupportedOperationException）</p>
<ul>
<li><p>tryAcquire</p>
</li>
<li><p>tryRelease</p>
</li>
<li><p>tryAcquireShared</p>
</li>
<li><p>tryReleaseShared</p>
</li>
<li><p>isHeldExclusively</p>
</li>
</ul>
<p><img src="/2022/09/01/JUC/image-20220826153237774.png" alt="image-20220826153237774" style="zoom:80%;"><img src="/2022/09/01/JUC/image-20220826153342401.png" alt="image-20220826153342401" style="zoom:80%;"></p>
<img src="/2022/09/01/JUC/image-20220826153027824.png" alt="image-20220826153027824" style="zoom:80%;">

<img src="/2022/09/01/JUC/image-20220826153102537.png" alt="image-20220826153102537" style="zoom:80%;">

<h4 id="ReentrantLock原理（非公平锁实现）"><a href="#ReentrantLock原理（非公平锁实现）" class="headerlink" title="ReentrantLock原理（非公平锁实现）"></a>ReentrantLock原理（非公平锁实现）</h4><p>1.没有竞争时，state从0改为1，并将Owner改为自己【Thread-0】</p>
<img src="/2022/09/01/JUC/image-20220826153700629.png" alt="image-20220826153700629" style="zoom:80%;">



<img src="/2022/09/01/JUC/image-20220826154010516.png" alt="image-20220826154010516" style="zoom:80%;">

<p>2.有竞争时</p>
<p><img src="/typora-user-images%5Cimage-20220826154025734.png" alt="image-20220826154025734"></p>
<img src="/2022/09/01/JUC/image-20220826154044609.png" alt="image-20220826154044609" style="zoom:80%;">

<p>Thread-1 执行了</p>
<ol>
<li><p>CAS 尝试将 state 由 0 改为 1，结果失败</p>
</li>
<li><p>进入acquire中的 tryAcquire 逻辑，这时 state 已经是1，结果仍然失败（尝试重新加锁）</p>
</li>
<li><p>接下来进入 addWaiter 逻辑，构造 Node 队列</p>
</li>
</ol>
<p>图中黄色三角表示该 Node 的 waitStatus 状态，其中 0 为默认正常状态</p>
<p>Node 的创建是懒惰的</p>
<p>其中第一个 Node 称为 Dummy（哑元）或哨兵，用来占位，并不关联线程</p>
<img src="/2022/09/01/JUC/image-20220826154120285.png" alt="image-20220826154120285" style="zoom:80%;">

<p>当前线程进入 acquireQueued 逻辑</p>
<ol>
<li><p>acquireQueued 会在一个死循环中不断尝试获得锁，失败后进入 park 阻塞</p>
</li>
<li><p>如果自己是紧邻着 head（排第二位），那么再次 tryAcquire 尝试获取锁，当然这时 state 仍为 1，失败</p>
</li>
<li><p>进入 shouldParkAfterFailedAcquire 逻辑，将前驱 node，即 head 的 waitStatus 改为 -1，这次返回 false（-1代表有责任唤醒其后继节点）</p>
</li>
</ol>
<p><img src="/typora-user-images%5Cimage-20220826154702722.png" alt="image-20220826154702722"></p>
<img src="/2022/09/01/JUC/image-20220826154953365.png" alt="image-20220826154953365" style="zoom:80%;">

<ol start="4">
<li>shouldParkAfterFailedAcquire 执行完毕回到 acquireQueued ，再次 tryAcquire 尝试获取锁，当然这时</li>
</ol>
<p>state 仍为 1，失败</p>
<ol start="5">
<li>当再次进入 shouldParkAfterFailedAcquire 时，这时因为其前驱 node 的 waitStatus 已经是 -1，这次返回</li>
</ol>
<p>true</p>
<ol start="6">
<li>进入 parkAndCheckInterrupt， Thread-1 park（灰色表示）</li>
</ol>
<p><img src="/typora-user-images%5Cimage-20220826155153454.png" alt="image-20220826155153454"></p>
<img src="/2022/09/01/JUC/image-20220826155232539.png" alt="image-20220826155232539" style="zoom: 67%;">

<p>再次有多个线程经历上述过程竞争失败，变成这个样子</p>
<img src="/2022/09/01/JUC/image-20220826155248963.png" alt="image-20220826155248963" style="zoom: 67%;">

<p>Thread-0 释放锁，进入 tryRelease 流程，如果成功</p>
<p>设置 exclusiveOwnerThread 为 null</p>
<p>state &#x3D; 0</p>
<img src="/2022/09/01/JUC/image-20220826155510110.png" alt="image-20220826155510110" style="zoom:67%;">

<p>当前队列不为 null，并且 head 的 waitStatus &#x3D; -1，进入 unparkSuccessor 流程</p>
<p>找到队列中离 head 最近的一个 Node（没取消的），unpark 恢复其运行，本例中即为 Thread-1</p>
<p>回到 Thread-1 的 acquireQueued 流程</p>
<img src="/2022/09/01/JUC/image-20220826155728301.png" alt="image-20220826155728301" style="zoom: 80%;">

<img src="/2022/09/01/JUC/image-20220826155943764.png" alt="image-20220826155943764" style="zoom: 67%;">

<p>如果加锁成功（没有竞争），会设置</p>
<ul>
<li><p>exclusiveOwnerThread 为 Thread-1，state &#x3D; 1</p>
</li>
<li><p>head 指向刚刚 Thread-1 所在的 Node，该 Node 清空 Thread</p>
</li>
<li><p>原本的 head 因为从链表断开，而可被垃圾回收</p>
</li>
</ul>
<p>如果这时候有其它线程来竞争（非公平的体现），例如这时有 Thread-4 来了</p>
<img src="/2022/09/01/JUC/image-20220826160136113.png" alt="image-20220826160136113" style="zoom:67%;">

<p>如果不巧又被 Thread-4 占了先</p>
<ul>
<li><p>Thread-4 被设置为 exclusiveOwnerThread，state &#x3D; 1</p>
</li>
<li><p>Thread-1 再次进入 acquireQueued 流程，获取锁失败，重新进入 park 阻</p>
</li>
</ul>
<p><strong>可重入原理</strong></p>
<p>第一次设置状态为1</p>
<p>之后如果已经获得了锁，计数次数不断累加</p>
<img src="/2022/09/01/JUC/image-20220826160527607.png" alt="image-20220826160527607" style="zoom:80%;">

<p>释放锁</p>
<p>计数-1，state没有减到0，返回false，减到0，返回true，Owner设为null</p>
<img src="/2022/09/01/JUC/image-20220826160740536.png" alt="image-20220826160740536" style="zoom: 80%;">

<p><strong>不可打断模式</strong></p>
<p>在此模式下，即使它被打断，仍会驻留在 AQS 队列中，一直要等到获得锁后方能得知自己被打断了</p>
<p><strong>可打断模式</strong></p>
<p><img src="/typora-user-images%5Cimage-20220826161410194.png" alt="image-20220826161410194"></p>
<p>在被打断时会抛出异常，而不会进入for循环，停止去等待</p>
<p><strong>公平锁原理</strong></p>
<p><img src="/typora-user-images%5Cimage-20220826161759586.png" alt="image-20220826161759586"></p>
<p>检查AQS队列中是否有老二节点或检查当前节点是不是老二节点，如果没有才回去竞争，如果当前节点不是老二节点，说明有前驱节点在等待，则不会进入compareAndSetState()</p>
<p><strong>条件变量原理</strong></p>
<p>await原理</p>
<p>开始 Thread-0 持有锁，调用 await，进入 ConditionObject 的 addConditionWaiter 流程</p>
<p>创建新的 Node 状态为 -2（Node.CONDITION），关联 Thread-0，加入等待队列尾部</p>
<img src="/2022/09/01/JUC/image-20220826162556697.png" alt="image-20220826162556697" style="zoom:80%;">



<img src="/2022/09/01/JUC/image-20220826162948005.png" alt="image-20220826162948005" style="zoom:80%;">

<p>接下来进入 AQS 的 fullyRelease 流程，释放同步器上的锁（释放可重入锁所有重入的次数）</p>
<img src="/2022/09/01/JUC/image-20220826162618897.png" alt="image-20220826162618897" style="zoom:80%;">

<p>unpark AQS 队列中的下一个节点，竞争锁，假设没有其他竞争线程，那么 Thread-1 竞争成功</p>
<img src="/2022/09/01/JUC/image-20220826162637768.png" alt="image-20220826162637768" style="zoom:80%;">

<p>park 阻塞 Thread-0</p>
<img src="/2022/09/01/JUC/image-20220826162651360.png" alt="image-20220826162651360" style="zoom:80%;">

<p>signal原理</p>
<p>假设 Thread-1 要来唤醒 Thread-0</p>
<img src="/2022/09/01/JUC/image-20220826163129737.png" alt="image-20220826163129737" style="zoom:80%;">

<p>进入 ConditionObject 的 doSignal 流程，取得等待队列中第一个 Node，即 Thread-0 所在 Node</p>
<p><img src="/typora-user-images%5Cimage-20220826163411187.png" alt="image-20220826163411187"></p>
<img src="/2022/09/01/JUC/image-20220826163209070.png" alt="image-20220826163209070" style="zoom:80%;">

<p>执行 transferForSignal 流程，将该 Node 加入 AQS 队列尾部，将 Thread-0 的 waitStatus 改为 0，Thread-3 的waitStatus 改为 -1</p>
<img src="/2022/09/01/JUC/image-20220826163242657.png" alt="image-20220826163242657" style="zoom:80%;">

<h4 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h4><p> <strong>ReentrantReadWriteLock</strong></p>
<p>当【读操作】远远高于【写操作】时，这时候使用 读写锁 让【 读-读】 可以并发，提高性能。 </p>
<p>读锁-读锁 可以并发</p>
<p>读锁-写锁 相互阻塞</p>
<p>写锁-写锁 也是相互阻塞的</p>
<p>注意事项</p>
<ul>
<li>读锁不支持条件变量</li>
</ul>
<ul>
<li><p>重入时升级不支持：即持有读锁的情况下去获取写锁，会导致获取写锁永久等待</p>
</li>
<li><p>重入时降级支持：即持有写锁的情况下去获取读锁</p>
</li>
</ul>
<p><strong>StampedLock</strong></p>
<p>该类自 JDK 8 加入，是为了进一步优化读性能，它的特点是在使用读锁、写锁时都必须配合【戳】使用</p>
<p>加解读锁</p>
<p><img src="/typora-user-images%5Cimage-20220826164613917.png" alt="image-20220826164613917"></p>
<p>加解写锁</p>
<p><img src="/typora-user-images%5Cimage-20220826164622020.png" alt="image-20220826164622020"></p>
<p>乐观读，StampedLock 支持 tryOptimisticRead() 方法（乐观读），读取完毕后需要做一次 戳校验 如果校验通</p>
<p>过，表示这期间确实没有写操作，数据可以安全使用，如果校验没通过，需要重新获取读锁，保证数据安全。</p>
<p><img src="/typora-user-images%5Cimage-20220826164628446.png" alt="image-20220826164628446"></p>
<h4 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h4><p>信号量，用来限制能同时访问共享资源的线程上限。</p>
<p>例如      此实例最多三个线程访问</p>
<img src="/2022/09/01/JUC/image-20220826164949724.png" alt="image-20220826164949724" style="zoom:67%;">

<p><strong>原理</strong></p>
<p>Semaphore 有点像一个停车场，permits 就好像停车位数量，当线程获得了 permits 就像是获得了停车位，然后</p>
<p>停车场显示空余车位减一</p>
<p>刚开始，state为 3，这时 5 个线程来获取资源</p>
<img src="/2022/09/01/JUC/image-20220826165525001.png" alt="image-20220826165525001" style="zoom:50%;">

<p>假设其中 Thread-1，Thread-2，Thread-4 cas 竞争成功，而 Thread-0 和 Thread-3 竞争失败，进入 AQS 队列park 阻塞</p>
<img src="/2022/09/01/JUC/image-20220826165547511.png" alt="image-20220826165547511" style="zoom: 80%;">

<p>这时 Thread-4 释放了 permits，state+1状态如下</p>
<img src="/2022/09/01/JUC/image-20220826165713631.png" alt="image-20220826165713631" style="zoom:67%;">

<p>接下来 Thread-0 竞争成功，获得permits 再次设置state为 0，设置自己为 head 节点，断开原来的 head 节点，unpark 接</p>
<p>下来的 Thread-3 节点，但由于 permits 是 0，因此 Thread-3 在尝试不成功后再次进入 park 状</p>
<h4 id="CountdownLatch"><a href="#CountdownLatch" class="headerlink" title="CountdownLatch"></a>CountdownLatch</h4><p>用来进行线程同步协作，等待所有线程完成倒计时。</p>
<p>其中构造参数用来初始化等待计数值，等待线程调用await() 用来等待计数归零，其他线程调用countDown() 用来让计数减一，减到零等待线程回复运行</p>
<h4 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h4><p> 循环栅栏，用来进行线程协作，等待线程满足某个计数。（此技术可恢复成初始值）构造时设置『计数个数』，每个线程执</p>
<p>行到某个需要“同步”的时刻调用 await() 方法进行等待，当等待的线程数满足『计数个数』时，继续执行</p>
<p><img src="/typora-user-images%5Cimage-20220826170838931.png" alt="image-20220826170838931"></p>
<h4 id="线程安全集合类"><a href="#线程安全集合类" class="headerlink" title="线程安全集合类"></a>线程安全集合类</h4><p><img src="/typora-user-images%5Cimage-20220826171327567.png" alt="image-20220826171327567"></p>
<ul>
<li><p>遗留的线程安全集合如 Hashtable ， Vector</p>
</li>
<li><p>使用 Collections 装饰的线程安全集合，如：</p>
<ul>
<li>Collections.synchronizedCollection</li>
<li>Collections.synchronizedList</li>
<li>Collections.synchronizedMap</li>
<li>Collections.synchronizedSet</li>
<li>Collections.synchronizedNavigableMap</li>
<li>Collections.synchronizedNavigableSet </li>
<li>Collections.synchronizedSortedMap</li>
<li>Collections.synchronizedSortedSet</li>
</ul>
</li>
<li><p>J.U.C 安全集合</p>
<ul>
<li><p>Blocking 大部分实现基于锁，并提供用来阻塞的方法</p>
</li>
<li><p>CopyOnWrite 之类容器修改开销相对较重</p>
</li>
<li><p>Concurrent 类型的容器</p>
<ul>
<li><p>内部很多操作使用 cas 优化，一般可以提供较高吞吐量</p>
</li>
<li><p>弱一致性</p>
<p>1.遍历时弱一致性，例如，当利用迭代器遍历时，如果容器发生修改，迭代器仍然可以继续进行遍</p>
<p>历，这时内容是旧的</p>
<p>2.求大小弱一致性，size 操作未必是 100% 准确</p>
<p>3.读取弱一致性</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h4><p><strong>Java 8</strong> </p>
<p>数组（Node） +（ 链表 Node | 红黑树 TreeNode ） 以下数组简称（table），链表简称（bin）</p>
<ul>
<li><p>初始化，使用 cas 来保证并发安全，懒惰初始化 table</p>
</li>
<li><p>树化，当 table.length &lt; 64 时，先尝试扩容，超过 64 时，并且 bin.length &gt; 8 时，会将链表树化，树化过程会用 synchronized 锁住链表头</p>
</li>
<li><p>put，如果该 bin 尚未创建，只需要使用 cas 创建 bin；如果已经有了，锁住链表头进行后续 put 操作，元素添加至 bin 的尾部</p>
</li>
<li><p>get，无锁操作仅需要保证可见性，扩容过程中 get 操作拿到的是 ForwardingNode 它会让 get 操作在新table 进行搜索</p>
</li>
<li><p>扩容，扩容时以 bin 为单位进行，需要对 bin 进行 synchronized，但这时妙的是其它竞争线程也不是无事可做，它们会帮助把其它 bin 进行扩容，扩容时平均只有 1&#x2F;6 的节点会把复制到新 table 中</p>
</li>
<li><p>size，元素个数保存在 baseCount 中，并发时的个数变动保存在 CounterCell[] 当中。最后统计数量时累加即可</p>
</li>
</ul>
<p><img src="/typora-user-images%5Cimage-20220826173727926.png" alt="image-20220826173727926"></p>
<p><strong>java7</strong></p>
<p>它维护了一个 segment 数组，每个 segment 对应一把锁,每个HasnEntry中又是数组+链表的结构</p>
<p>优点：如果多个线程访问不同的 segment，实际是没有冲突的，这与 jdk8 中是类似的</p>
<p>缺点：Segments 数组默认大小为16，这个容量初始化指定后就不能改变了，并且不是懒惰初始化</p>
<img src="/2022/09/01/JUC/image-20220826173515748.png" alt="image-20220826173515748" style="zoom: 67%;">

<p>其中 this.segmentShift 和 this.segmentMask 的作用是决定将 key 的 hash 结果匹配到哪个 segment</p>
<p>例如，根据某一 hash 值求 segment 位置，先将高位向低位移动 this.segmentShift 位</p>
<p><img src="/typora-user-images%5Cimage-20220826174248152.png" alt="image-20220826174248152"></p>
<p>结果再与 this.segmentMask 做位于运算，最终得到 1010 即下标为 10 的 segment</p>
<p><img src="/typora-user-images%5Cimage-20220826174307398.png" alt="image-20220826174307398"></p>
<h4 id="LinkedBlockingQueue"><a href="#LinkedBlockingQueue" class="headerlink" title="LinkedBlockingQueue"></a>LinkedBlockingQueue</h4><p><strong>原理</strong></p>
<p>初始化链表 last &#x3D; head &#x3D; new Node<E>(null); Dummy 节点用来占位，item 为 null</E></p>
<img src="/2022/09/01/JUC/image-20220826174623421.png" alt="image-20220826174623421" style="zoom:50%;">



<p>当一个节点入队 last &#x3D; last.next &#x3D; node;</p>
<img src="/2022/09/01/JUC/image-20220826174651434.png" alt="image-20220826174651434" style="zoom:67%;">

<p>再来一个节点入队 last &#x3D; last.next &#x3D; node;</p>
<img src="/2022/09/01/JUC/image-20220826174711055.png" alt="image-20220826174711055" style="zoom:67%;">

<p>出队h &#x3D; head</p>
<img src="/2022/09/01/JUC/image-20220826174734826.png" alt="image-20220826174734826" style="zoom:67%;">

<p>first &#x3D; h.next</p>
<img src="/2022/09/01/JUC/image-20220826174748174.png" alt="image-20220826174748174" style="zoom:67%;">

<p>h.next &#x3D; h</p>
<img src="/2022/09/01/JUC/image-20220826174812143.png" alt="image-20220826174812143" style="zoom:67%;">

<p>head &#x3D; first</p>
<img src="/2022/09/01/JUC/image-20220826174836535.png" alt="image-20220826174836535" style="zoom:67%;">

<p>E x &#x3D; first.item;</p>
<p>first.item &#x3D; null;</p>
<p>return x;</p>
<img src="/2022/09/01/JUC/image-20220826175007990.png" alt="image-20220826175007990" style="zoom:67%;">

<p> <strong>加锁分析</strong></p>
<p>&#x3D;&#x3D;高明之处&#x3D;&#x3D;在于用了两把锁和 dummy 节点</p>
<ul>
<li><p>用一把锁，同一时刻，最多只允许有一个线程（生产者或消费者，二选一）执行</p>
</li>
<li><p>用两把锁，同一时刻，可以允许两个线程同时（一个生产者与一个消费者）执行</p>
<ul>
<li>消费者与消费者线程仍然串行</li>
<li>生产者与生产者线程仍然串行</li>
</ul>
</li>
</ul>
<p>线程安全分析</p>
<ul>
<li><p>当节点总数大于 2 时（包括 dummy 节点），putLock 保证的是 last 节点的线程安全，takeLock 保证的是</p>
<p>head 节点的线程安全。两把锁保证了入队和出队没有竞争</p>
</li>
<li><p>当节点总数等于 2 时（即一个 dummy 节点，一个正常节点）这时候，仍然是两把锁锁两个对象，不会竞争</p>
</li>
<li><p>当节点总数等于 1 时（就一个 dummy 节点）这时 take 线程会被 notEmpty 条件阻塞，有竞争，会阻塞</p>
</li>
</ul>
<p><strong>性能比较</strong></p>
<p>主要列举 LinkedBlockingQueue 与 ArrayBlockingQueue 的性能比较</p>
<ul>
<li><p>Linked 支持有界，Array 强制有界</p>
</li>
<li><p>Linked 实现是链表，Array 实现是数组</p>
</li>
<li><p>Linked 是懒惰的，而 Array 需要提前初始化 Node 数组</p>
</li>
<li><p>Linked 每次入队会生成新 Node，而 Array 的 Node 是提前创建好的</p>
</li>
<li><p>Linked 两把锁，Array 一把锁</p>
</li>
</ul>
<h4 id="ConcurrentLinkedQueue"><a href="#ConcurrentLinkedQueue" class="headerlink" title="ConcurrentLinkedQueue"></a>ConcurrentLinkedQueue</h4><p>ConcurrentLinkedQueue 的设计与 LinkedBlockingQueue 非常像，也是</p>
<ul>
<li><p>两把【锁】，同一时刻，可以允许两个线程同时（一个生产者与一个消费者）执行</p>
</li>
<li><p>dummy 节点的引入让两把【锁】将来锁住的是不同对象，避免竞争</p>
</li>
<li><p>只是这【锁】使用了 cas 来实现</p>
</li>
</ul>
<h4 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h4><p>底层实现采用了【 写入时拷贝】 的思想，增删改操作会将底层数组拷贝一份，更改操作在新数组上执行，这时不影响其它线程的<strong>并发读</strong>，<strong>读写分离</strong>。</p>
<p>读读并发 读写并发 写写互斥</p>
<p>适合『读多写少』的应用场景</p>
<img src="/2022/09/01/JUC/image-20220826180058867.png" alt="image-20220826180058867" style="zoom:67%;">

<p><strong>这里的源码版本是 Java 11，在 Java 1.8 中使用的是ReentrantLock而不是 synchronized</strong></p>
<p>读操作并未加锁</p>
<img src="/2022/09/01/JUC/image-20220826180230264.png" alt="image-20220826180230264" style="zoom:67%;">

<p><strong>get弱一致性</strong></p>
<img src="/2022/09/01/JUC/image-20220826180348567.png" alt="image-20220826180348567" style="zoom:80%;">

<img src="/2022/09/01/JUC/image-20220826180412869.png" alt="image-20220826180412869" style="zoom:80%;">

<p><strong>迭代器弱一致性</strong></p>
<img src="/2022/09/01/JUC/image-20220826180510564.png" alt="image-20220826180510564" style="zoom:80%;">

<p>新线程在移除时是先拷贝一份，在新数组里删除</p>
<p>而迭代器仍然用的是旧数组，遍历时仍然是旧数组</p>
<p>不要觉得弱一致性就不好</p>
<ul>
<li><p>数据库的 MVCC 都是弱一致性的表现</p>
</li>
<li><p>并发高和一致性是矛盾的，需要权衡</p>
</li>
</ul>

    </div>

    
    
    
        <div class="reward-container">
  <div>原创技术分享，您的支持将鼓励我继续创作</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="wFei 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="wFei 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>wFei
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://holdustogether.github.io/2022/09/01/JUC/" title="JUC">https://holdustogether.github.io/2022/09/01/JUC/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java/" rel="tag"># Java</a>
              <a href="/tags/JUC/" rel="tag"># JUC</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/08/30/%E6%9C%80%E9%9A%BE%E4%B8%8D%E8%BF%87%E5%9D%9A%E6%8C%81/" rel="prev" title="最难不过坚持">
      <i class="fa fa-chevron-left"></i> 最难不过坚持
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/09/01/spring%20cloud%E7%AF%87/" rel="next" title="Spring Cloud">
      Spring Cloud <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#JUC"><span class="nav-number">1.</span> <span class="nav-text">JUC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B"><span class="nav-number">1.1.</span> <span class="nav-text">进程与线程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.1.</span> <span class="nav-text">概念</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java%E7%BA%BF%E7%A8%8B"><span class="nav-number">1.2.</span> <span class="nav-text">Java线程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-number">1.2.1.</span> <span class="nav-text">创建线程的方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.2.</span> <span class="nav-text">常用方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%A4%E9%98%B6%E6%AE%B5%E7%BB%88%E6%AD%A2%E4%B9%8Binterrupt%EF%BC%88%E5%A6%82%E4%BD%95%E5%9C%A8T1%E4%BC%98%E9%9B%85%E7%9A%84%E7%BB%88%E6%AD%A2%E7%BA%BF%E7%A8%8BT2%EF%BC%89"><span class="nav-number">1.2.3.</span> <span class="nav-text">两阶段终止之interrupt（如何在T1优雅的终止线程T2）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B"><span class="nav-number">1.2.4.</span> <span class="nav-text">主线程与守护线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%8A%B6%E6%80%81"><span class="nav-number">1.2.5.</span> <span class="nav-text">线程的状态</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%82%B2%E8%A7%82%E9%94%81"><span class="nav-number">1.3.</span> <span class="nav-text">悲观锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="nav-number">1.3.1.</span> <span class="nav-text">线程安全问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E9%87%8F%E7%BA%A7%E9%94%81synchronized"><span class="nav-number">1.3.2.</span> <span class="nav-text">重量级锁synchronized</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%81%E4%BC%98%E5%8C%96"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">锁优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%81%E8%86%A8%E8%83%80"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">锁膨胀</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wait-notify"><span class="nav-number">1.3.3.</span> <span class="nav-text">wait - notify</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#join"><span class="nav-number">1.3.4.</span> <span class="nav-text">join</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Park-amp-amp-Unpark"><span class="nav-number">1.3.5.</span> <span class="nav-text">Park&amp;&amp;Unpark</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E6%8A%8A%E9%94%81"><span class="nav-number">1.3.6.</span> <span class="nav-text">多把锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%BB%E9%94%81"><span class="nav-number">1.3.7.</span> <span class="nav-text">死锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B4%BB%E9%94%81"><span class="nav-number">1.3.8.</span> <span class="nav-text">活锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A5%A5%E9%A5%BF"><span class="nav-number">1.3.9.</span> <span class="nav-text">饥饿</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ReentrantLock"><span class="nav-number">1.3.10.</span> <span class="nav-text">ReentrantLock</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B-JMM"><span class="nav-number">1.4.</span> <span class="nav-text">Java内存模型 JMM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="nav-number">1.4.1.</span> <span class="nav-text">三大特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%A4%E9%98%B6%E6%AE%B5%E7%BB%88%E6%AD%A2-volatile"><span class="nav-number">1.4.2.</span> <span class="nav-text">两阶段终止-volatile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#volatile%E5%8E%9F%E7%90%86"><span class="nav-number">1.4.3.</span> <span class="nav-text">volatile原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%90%E8%A7%82%E9%94%81"><span class="nav-number">1.5.</span> <span class="nav-text">乐观锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cas%EF%BC%88-Compare-And-Set%EF%BC%89"><span class="nav-number">1.5.1.</span> <span class="nav-text">cas（ Compare And Set）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%AD%90%E6%95%B4%E6%95%B0"><span class="nav-number">1.5.2.</span> <span class="nav-text">原子整数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%AD%90%E5%BC%95%E7%94%A8"><span class="nav-number">1.5.3.</span> <span class="nav-text">原子引用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%AD%90%E6%95%B0%E7%BB%84"><span class="nav-number">1.5.4.</span> <span class="nav-text">原子数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5%E6%9B%B4%E6%96%B0%E5%99%A8"><span class="nav-number">1.5.5.</span> <span class="nav-text">字段更新器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%AD%90%E7%B4%AF%E5%8A%A0%E5%99%A8"><span class="nav-number">1.5.6.</span> <span class="nav-text">原子累加器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Unsafe"><span class="nav-number">1.5.7.</span> <span class="nav-text">Unsafe</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E5%8F%AF%E5%8F%98"><span class="nav-number">1.6.</span> <span class="nav-text">不可变</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7"><span class="nav-number">1.7.</span> <span class="nav-text">并发工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="nav-number">1.7.1.</span> <span class="nav-text">线程池</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="nav-number">1.7.1.1.</span> <span class="nav-text">自定义线程池</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ThreadPoolExecutor"><span class="nav-number">1.7.1.2.</span> <span class="nav-text">ThreadPoolExecutor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Fork-x2F-join"><span class="nav-number">1.7.1.3.</span> <span class="nav-text">Fork&#x2F;join</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JUC%E5%8E%9F%E7%90%86"><span class="nav-number">1.7.2.</span> <span class="nav-text">JUC原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#aqs%E5%8E%9F%E7%90%86"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">aqs原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ReentrantLock%E5%8E%9F%E7%90%86%EF%BC%88%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81%E5%AE%9E%E7%8E%B0%EF%BC%89"><span class="nav-number">1.7.2.2.</span> <span class="nav-text">ReentrantLock原理（非公平锁实现）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%BB%E5%86%99%E9%94%81"><span class="nav-number">1.7.2.3.</span> <span class="nav-text">读写锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Semaphore"><span class="nav-number">1.7.2.4.</span> <span class="nav-text">Semaphore</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CountdownLatch"><span class="nav-number">1.7.2.5.</span> <span class="nav-text">CountdownLatch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CyclicBarrier"><span class="nav-number">1.7.2.6.</span> <span class="nav-text">CyclicBarrier</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%9B%86%E5%90%88%E7%B1%BB"><span class="nav-number">1.7.2.7.</span> <span class="nav-text">线程安全集合类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ConcurrentHashMap"><span class="nav-number">1.7.2.8.</span> <span class="nav-text">ConcurrentHashMap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LinkedBlockingQueue"><span class="nav-number">1.7.2.9.</span> <span class="nav-text">LinkedBlockingQueue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ConcurrentLinkedQueue"><span class="nav-number">1.7.2.10.</span> <span class="nav-text">ConcurrentLinkedQueue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CopyOnWriteArrayList"><span class="nav-number">1.7.2.11.</span> <span class="nav-text">CopyOnWriteArrayList</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wFei"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">wFei</p>
  <div class="site-description" itemprop="description">不要停止成为更好的自己</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/holdustogether" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;holdustogether" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/wf1657885988@163.com" title="E-Mail → wf1657885988@163.com"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
	<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=450 src="//music.163.com/outchain/player?type=0&id=7614662893&auto=1&height=430"></iframe>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022.08 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wFei</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共65.1k字</span>
</div>

    <div>
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
    </div>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='128,136,147' opacity='0.8' zIndex='-1' count='150' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

  <!-- ҳ����С���� -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
