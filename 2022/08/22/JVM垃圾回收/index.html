<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"holdustogether.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="1. 如何判断对象可以回收1.1 引用计数法  只要对象被引用，计数就+1。不再引用就-1。 为0被回收 循环引用问题。 1.2 可达性分析算法  Java 虚拟机中的垃圾回收器采用可达性分析来探索所有存活的对象 扫描堆中的对象，看是否能够沿着 GC Root对象 为起点的引用链找到该对象，找不到，表示可以 回收 哪些对象可以作为 GC Root ? MAT（memory analyzer）工">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM 垃圾回收">
<meta property="og:url" content="https://holdustogether.github.io/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/index.html">
<meta property="og:site_name" content="南北橘子">
<meta property="og:description" content="1. 如何判断对象可以回收1.1 引用计数法  只要对象被引用，计数就+1。不再引用就-1。 为0被回收 循环引用问题。 1.2 可达性分析算法  Java 虚拟机中的垃圾回收器采用可达性分析来探索所有存活的对象 扫描堆中的对象，看是否能够沿着 GC Root对象 为起点的引用链找到该对象，找不到，表示可以 回收 哪些对象可以作为 GC Root ? MAT（memory analyzer）工">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://holdustogether.github.io/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822104352038.png">
<meta property="og:image" content="https://holdustogether.github.io/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822105654824.png">
<meta property="og:image" content="https://holdustogether.github.io/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822105727568.png">
<meta property="og:image" content="https://holdustogether.github.io/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822105908299.png">
<meta property="og:image" content="https://holdustogether.github.io/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822105931557.png">
<meta property="og:image" content="https://holdustogether.github.io/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822111327376.png">
<meta property="og:image" content="https://holdustogether.github.io/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822111531389.png">
<meta property="og:image" content="https://holdustogether.github.io/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822111550191.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822112654594.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822113339234.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822113438244.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822114130477.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822115242586.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822115450644.png">
<meta property="og:image" content="https://holdustogether.github.io/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822120017301.png">
<meta property="article:published_time" content="2022-08-22T02:41:13.926Z">
<meta property="article:modified_time" content="2022-09-20T03:36:38.624Z">
<meta property="article:author" content="wFei">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="JVM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://holdustogether.github.io/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822104352038.png">

<link rel="canonical" href="https://holdustogether.github.io/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>JVM 垃圾回收 | 南北橘子</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="南北橘子" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/holdustogether" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">南北橘子</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://holdustogether.github.io/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wFei">
      <meta itemprop="description" content="不要停止成为更好的自己">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="南北橘子">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          JVM 垃圾回收
        </h1>

        <div class="post-meta">
	  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-22 10:41:13" itemprop="dateCreated datePublished" datetime="2022-08-22T10:41:13+08:00">2022-08-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-09-20 11:36:38" itemprop="dateModified" datetime="2022-09-20T11:36:38+08:00">2022-09-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/JVM/" itemprop="url" rel="index"><span itemprop="name">JVM</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <span id="more"></span>

<h2 id="1-如何判断对象可以回收"><a href="#1-如何判断对象可以回收" class="headerlink" title="1. 如何判断对象可以回收"></a>1. 如何判断对象可以回收</h2><h3 id="1-1-引用计数法"><a href="#1-1-引用计数法" class="headerlink" title="1.1 引用计数法"></a>1.1 引用计数法</h3><hr>
<p><img src="/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822104352038.png" alt="image-20220822104352038"></p>
<p>只要对象被引用，计数就+1。不再引用就-1。 为0被回收</p>
<p>循环引用问题。</p>
<h3 id="1-2-可达性分析算法"><a href="#1-2-可达性分析算法" class="headerlink" title="1.2 可达性分析算法"></a>1.2 可达性分析算法</h3><hr>
<ul>
<li>Java 虚拟机中的垃圾回收器采用可达性分析来探索所有存活的对象</li>
<li>扫描堆中的对象，看是否能够沿着 GC Root对象 为起点的引用链找到该对象，找不到，表示可以 回收</li>
<li>哪些对象可以作为 GC Root ?<ul>
<li><p>MAT（memory analyzer）工具</p>
</li>
<li><p>栈引用的对象，被加锁的对象还有糸统核心的类对象 堆中的</p>
</li>
</ul>
</li>
</ul>
<h3 id="1-3-四种引用"><a href="#1-3-四种引用" class="headerlink" title="1.3 四种引用"></a>1.3 四种引用</h3><hr>
<ol>
<li>强引用</li>
</ol>
<ul>
<li>只有所有 GC Roots 对象都不通过【强引用】引用该对象，该对象才能被垃圾回收</li>
</ul>
<ol start="2">
<li>软引用（SoftReference）</li>
</ol>
<ul>
<li>仅有软引用引用该对象时，在垃圾回收后，内存仍不足时会再次出发垃圾回收，回收软引用 对象</li>
<li>可以配合引用队列来释放软引用自身</li>
</ul>
<ol start="3">
<li>弱引用（WeakReference）</li>
</ol>
<ul>
<li>仅有弱引用引用该对象时，在垃圾回收时，无论内存是否充足，都会回收弱引用对象</li>
<li>可以配合引用队列来释放弱引用自身</li>
</ul>
<ol start="4">
<li>虚引用（PhantomReference）</li>
</ol>
<ul>
<li>必须配合引用队列使用，主要配合 ByteBuffer 使用，被引用对象回收时，会将虚引用入队， 由 Reference Handler 线程调用虚引用相关方法释放直接内存</li>
</ul>
<ol start="5">
<li>终结器引用（FinalReference）</li>
</ol>
<ul>
<li>无需手动编码，但其内部配合引用队列使用，在垃圾回收时，终结器引用入队（被引用对象 暂时没有被回收），再由 Finalizer 线程通过终结器引用找到被引用对象并调用它的 finalize 方法，第二次 GC 时才能回收被引用对象</li>
</ul>
<h2 id="2-垃圾回收算法"><a href="#2-垃圾回收算法" class="headerlink" title="2. 垃圾回收算法"></a>2. 垃圾回收算法</h2><h3 id="2-1-标记清除"><a href="#2-1-标记清除" class="headerlink" title="2.1 标记清除"></a>2.1 标记清除</h3><hr>
<p>定义： Mark Sweep</p>
<ul>
<li><p>速度较快</p>
</li>
<li><p>会造成内存碎片</p>
<p><img src="/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822105654824.png" alt="image-20220822105654824"></p>
</li>
</ul>
<h3 id="2-2-标记整理"><a href="#2-2-标记整理" class="headerlink" title="2.2 标记整理"></a>2.2 标记整理</h3><hr>
<p>定义：Mark Compact</p>
<ul>
<li><p>速度慢</p>
</li>
<li><p>没有内存碎片</p>
<p><img src="/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822105727568.png" alt="image-20220822105727568"></p>
</li>
</ul>
<h3 id="2-3-复制"><a href="#2-3-复制" class="headerlink" title="2.3 复制"></a>2.3 复制</h3><hr>
<p>定义：Copy</p>
<ul>
<li>不会有内存碎片</li>
<li>需要占用双倍内存空间</li>
</ul>
<p><img src="/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822105908299.png" alt="image-20220822105908299"></p>
<h2 id="3-分代垃圾回收"><a href="#3-分代垃圾回收" class="headerlink" title="3. 分代垃圾回收"></a>3. 分代垃圾回收</h2><p><img src="/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822105931557.png" alt="image-20220822105931557"></p>
<ul>
<li>对象首先分配在伊甸园区域</li>
<li>新生代空间不足时，触发 minor gc，伊甸园和 from 存活的对象使用 copy 复制到 to 中，存活的 对象年龄加 1并且交换 from to</li>
<li>minor gc 会引发 stop the world，暂停其它用户的线程，等垃圾回收结束，用户线程才恢复运行</li>
<li>当对象寿命超过阈值时，会晋升至老年代，最大寿命是15（4bit）</li>
<li>当老年代空间不足，会先尝试触发 minor gc，如果之后空间仍不足，那么触发 full gc，STW的时 间更长</li>
<li>新生代存放朝生夕死的对象，老年代存放用的频繁的</li>
</ul>
<h3 id="3-1-相关-VM-参数"><a href="#3-1-相关-VM-参数" class="headerlink" title="3.1 相关 VM 参数"></a>3.1 相关 VM 参数</h3><hr>
<table>
<thead>
<tr>
<th>含义</th>
<th>参数</th>
</tr>
</thead>
<tbody><tr>
<td>堆初始大小</td>
<td>-Xms</td>
</tr>
<tr>
<td>堆最大大小</td>
<td>-Xmx 或 -XX:MaxHeapSize&#x3D;size</td>
</tr>
<tr>
<td>新生代大小</td>
<td>-Xmn 或 (-XX:NewSize&#x3D;size + -XX:MaxNewSize&#x3D;size )</td>
</tr>
<tr>
<td>幸存区比例（动态）</td>
<td>-XX:InitialSurvivorRatio&#x3D;ratio 和 -XX:+UseAdaptiveSizePolicy</td>
</tr>
<tr>
<td>幸存区比例</td>
<td>-XX:SurvivorRatio&#x3D;ratio</td>
</tr>
<tr>
<td>晋升阈值</td>
<td>-XX:MaxTenuringThreshold&#x3D;threshold</td>
</tr>
<tr>
<td>晋升详情</td>
<td>-XX:+PrintTenuringDistribution</td>
</tr>
<tr>
<td>GC详情</td>
<td>-XX:+PrintGCDetails -verbose:gc</td>
</tr>
<tr>
<td>FullGC 前 MinorGC</td>
<td>-XX:+ScavengeBeforeFullGC</td>
</tr>
</tbody></table>
<h2 id="4-垃圾回收器"><a href="#4-垃圾回收器" class="headerlink" title="4. 垃圾回收器"></a>4. 垃圾回收器</h2><ol>
<li>串行<ul>
<li>单线程</li>
<li>堆内存较小，适合个人电脑</li>
</ul>
</li>
<li>吞吐量优先</li>
</ol>
<ul>
<li>多线程</li>
<li>堆内存较大，多核 cpu</li>
<li>让单位时间内，STW 的时间最短 0.2 0.2 &#x3D; 0.4，垃圾回收时间占比最低，这样就称吞吐量高</li>
</ul>
<ol start="3">
<li>响应时间优先</li>
</ol>
<ul>
<li>多线程</li>
<li>堆内存较大，多核 cpu</li>
<li>尽可能让单次 STW 的时间最短 0.1 0.1 0.1 0.1 0.1 &#x3D; 0.5</li>
</ul>
<h3 id="4-1-串行"><a href="#4-1-串行" class="headerlink" title="4.1 串行"></a>4.1 串行</h3><hr>
<p><img src="/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822111327376.png" alt="image-20220822111327376"></p>
<p>复制算法 + 标记整理</p>
<p>新生代 + 老年代</p>
<h3 id="4-2-吞吐量优先"><a href="#4-2-吞吐量优先" class="headerlink" title="4.2 吞吐量优先"></a>4.2 吞吐量优先</h3><hr>
<p><img src="/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822111531389.png" alt="image-20220822111531389"></p>
<h3 id="4-3-响应时间优先-CMS"><a href="#4-3-响应时间优先-CMS" class="headerlink" title="4.3 响应时间优先 CMS"></a>4.3 响应时间优先 CMS</h3><hr>
<p><img src="/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.assets/image-20220822111550191.png" alt="image-20220822111550191"></p>
<h3 id="4-4-G1"><a href="#4-4-G1" class="headerlink" title="4.4 G1"></a>4.4 G1</h3><hr>
<p>定义：Garbage First</p>
<ul>
<li>2017 JDK 9 默认</li>
</ul>
<p>适用场景</p>
<ul>
<li>同时注重吞吐量（Throughput）和低延迟（Low latency），默认的暂停目标是 200 ms</li>
<li>超大堆内存，会将堆划分为多个大小相等的 Region</li>
<li>整体上是 标记+整理 算法，两个区域之间是 复制 算法</li>
</ul>
<p>相关 JVM 参数</p>
<p>-XX:+UseG1GC</p>
<p>-XX:G1HeapRegionSize&#x3D;size </p>
<p>-XX:MaxGCPauseMillis&#x3D;time</p>
<p><strong>因为堆内存大，所以回收速度会变慢，涉及到标记复制等。化整为零，方便进行优化，标记。加快速度。每个区都有完整的新生代老年代</strong>。</p>
<h4 id="1-G1-垃圾回收阶段"><a href="#1-G1-垃圾回收阶段" class="headerlink" title="1) G1 垃圾回收阶段"></a>1) G1 垃圾回收阶段</h4><img src="/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822112654594.png" alt="image-20220822112654594" style="zoom: 50%;">

<h4 id="2-Young-Collection"><a href="#2-Young-Collection" class="headerlink" title="2) Young Collection"></a>2) Young Collection</h4><ul>
<li>会STW</li>
</ul>
<img src="/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822113339234.png" alt="image-20220822113339234" style="zoom:33%;">

<h4 id="3-Young-Collection-CM"><a href="#3-Young-Collection-CM" class="headerlink" title="3) Young Collection + CM"></a>3) Young Collection + CM</h4><ul>
<li>在 Young GC 时会进行 GC Root 的初始标记</li>
<li>老年代占用堆空间比例达到阈值时，进行并发标记（不会 STW），由下面的 JVM 参数决定</li>
</ul>
<p>老年代占用堆空间比例达到阈值时，进行并发标记（不会 STW），由下面的 JVM 参数决定</p>
<img src="/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822113438244.png" alt="image-20220822113438244" style="zoom:33%;">

<h4 id="4-Mixed-Collection"><a href="#4-Mixed-Collection" class="headerlink" title="4) Mixed Collection"></a>4) Mixed Collection</h4><p>会对 E、S、O 进行全面垃圾回收</p>
<ul>
<li>最终标记（Remark）会 STW</li>
<li>拷贝存活（Evacuation）会 STW</li>
</ul>
<p>-XX:MaxGCPauseMillis&#x3D;ms 暂停时间，为了达到这个暂停时间，去优秀标记有价值的</p>
<img src="/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822114130477.png" alt="image-20220822114130477" style="zoom:33%;">

<h4 id="5-Full-GC"><a href="#5-Full-GC" class="headerlink" title="5) Full GC"></a>5) Full GC</h4><ul>
<li><p>SerialGC 串行</p>
<ul>
<li>新生代内存不足发生的垃圾收集 - minor gc  新生代的垃圾回收一般都是复制算法 老年代是标记整理</li>
<li>老年代内存不足发生的垃圾收集 - full gc</li>
</ul>
</li>
<li><p>ParallelGC 并行</p>
<ul>
<li>新生代内存不足发生的垃圾收集 - minor gc</li>
<li>老年代内存不足发生的垃圾收集 - full gc</li>
</ul>
</li>
<li><p>CMS 并发</p>
<ul>
<li>新生代内存不足发生的垃圾收集 - minor gc</li>
<li>老年代内存不足</li>
</ul>
</li>
<li><p>G1 并发</p>
<ul>
<li>新生代内存不足发生的垃圾收集 - minor gc</li>
<li>老年代内存不足 有个阈值，老年代内存占比堆内存达到百分之45，就会触发并发标记和混合收集。如果回收速度大于新产生速度，还不是FullGC，当小于速度的时候，并发就失败了，就会退回串行，并FullGC</li>
</ul>
</li>
</ul>
<h4 id="6-Young-Collection-跨代引用"><a href="#6-Young-Collection-跨代引用" class="headerlink" title="6) Young Collection 跨代引用"></a>6) Young Collection 跨代引用</h4><ul>
<li>新生代回收的跨代引用（老年代引用新生代）问题</li>
</ul>
<img src="/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822115242586.png" alt="image-20220822115242586" style="zoom:33%;">

<p>新生代回收需要找到根对象，然后可达算法找到幸存的，有些根对象在老年代中</p>
<ul>
<li>卡表与 Remembered Set</li>
<li>在引用变更时通过 post-write barrier + dirty card queue</li>
<li>concurrent refinement threads 更新 Remembered Set</li>
</ul>
<img src="/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822115450644.png" alt="image-20220822115450644" style="zoom:33%;">

<h4 id="7-Remark"><a href="#7-Remark" class="headerlink" title="7) Remark"></a>7) Remark</h4><p>pre-write barrier + satb_mark_queue 在对象引用前加入一个队列，完了再检查队列中的元素</p>
<img src="/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/image-20220822120017301.png" alt="image-20220822120017301" style="zoom:33%;">

<h4 id="8-JDK-8u20-字符串去重"><a href="#8-JDK-8u20-字符串去重" class="headerlink" title="8) JDK 8u20 字符串去重"></a>8) JDK 8u20 字符串去重</h4><ul>
<li>优点：节省大量内存</li>
<li>缺点：略微多占用了 cpu 时间，新生代回收时间略微增加</li>
</ul>
<p>-XX:+UseStringDeduplication</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>); <span class="comment">// char[]&#123;&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;&#125;</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>); <span class="comment">// char[]&#123;&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>将所有新分配的字符串放入一个队列</li>
<li>当新生代回收时，G1并发检查是否有字符串重复</li>
<li>如果它们值一样，让它们引用同一个 char[]</li>
<li>注意，与 String.intern() 不一样<ul>
<li>String.intern() 关注的是字符串对象</li>
<li>而字符串去重关注的是 char[]</li>
<li>在 JVM 内部，使用了不同的字符串表</li>
</ul>
</li>
</ul>
<h4 id="9-JDK-8u40-并发标记类卸载"><a href="#9-JDK-8u40-并发标记类卸载" class="headerlink" title="9) JDK 8u40 并发标记类卸载"></a>9) JDK 8u40 并发标记类卸载</h4><p>所有对象都经过并发标记后，就能知道哪些类不再被使用，当一个类加载器的所有类都不再使用，则卸 载它所加载的所有类</p>
<p>-XX:+ClassUnloadingWithConcurrentMark 默认启用</p>
<h4 id="10-JDK-8u60-回收巨型对象"><a href="#10-JDK-8u60-回收巨型对象" class="headerlink" title="10) JDK 8u60 回收巨型对象"></a>10) JDK 8u60 回收巨型对象</h4><ul>
<li>一个对象大于 region 的一半时，称之为巨型对象</li>
<li>G1 不会对巨型对象进行拷贝</li>
<li>回收时被优先考虑</li>
<li>G1 会跟踪老年代所有 incoming 引用，这样老年代 incoming 引用为0 的巨型对象就可以在新生 代垃圾回收时处理掉</li>
</ul>
<h4 id="11-JDK-9-并发标记起始时间的调整"><a href="#11-JDK-9-并发标记起始时间的调整" class="headerlink" title="11) JDK 9 并发标记起始时间的调整"></a>11) JDK 9 并发标记起始时间的调整</h4><ul>
<li>并发标记必须在堆空间占满前完成，否则退化为 FullGC</li>
<li>JDK 9 之前需要使用 -XX:InitiatingHeapOccupancyPercent</li>
<li>JDK 9 可以动态调整<ul>
<li>JDK 9 可以动态调整</li>
<li>进行数据采样并动态调整</li>
<li>总会添加一个安全的空档空间</li>
</ul>
</li>
</ul>
<h4 id="12-JDK-9-更高效的回收"><a href="#12-JDK-9-更高效的回收" class="headerlink" title="12) JDK 9 更高效的回收"></a>12) JDK 9 更高效的回收</h4><ul>
<li>250+增强</li>
<li>180+bug修复</li>
</ul>
<h2 id="5-垃圾回收调优"><a href="#5-垃圾回收调优" class="headerlink" title="5. 垃圾回收调优"></a>5. 垃圾回收调优</h2><p>预备知识</p>
<ul>
<li>掌握 GC 相关的 VM 参数，会基本的空间调整</li>
<li>掌握相关工具</li>
<li>明白一点：调优跟应用、环境有关，没有放之四海而皆准的法则</li>
</ul>
<h3 id="5-1-调优领域"><a href="#5-1-调优领域" class="headerlink" title="5.1 调优领域"></a>5.1 调优领域</h3><hr>
<ul>
<li>内存</li>
<li>锁竞争</li>
<li>cpu 占用</li>
<li>io</li>
</ul>
<h3 id="5-2-确定目标"><a href="#5-2-确定目标" class="headerlink" title="5.2 确定目标"></a>5.2 确定目标</h3><hr>
<ul>
<li>【低延迟】还是【高吞吐量】，选择合适的回收器</li>
<li>CMS，G1，ZGC</li>
<li>ParallelGC</li>
<li>Zing</li>
</ul>
<h3 id="5-3-最快的-GC"><a href="#5-3-最快的-GC" class="headerlink" title="5.3 最快的 GC"></a>5.3 最快的 GC</h3><hr>
<p>答案是不发生 GC</p>
<ul>
<li>查看 FullGC 前后的内存占用，考虑下面几个问题<ul>
<li><p>数据是不是太多？</p>
<ul>
<li>resultSet &#x3D; statement.executeQuery(“select * from 大表 limit n”)</li>
</ul>
</li>
<li><p>数据表示是否太臃肿？</p>
<ul>
<li>对象图</li>
<li>对象大小 16 Integer 24 int 4  对象瘦身</li>
</ul>
</li>
<li><p>是否存在内存泄漏？</p>
<ul>
<li>static Map map &#x3D;  长期存在的对象 一直往里加会造成溢出， 通过下面的三个方法</li>
<li>软</li>
<li>弱</li>
<li>第三方缓存实现</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-4-新生代调优"><a href="#5-4-新生代调优" class="headerlink" title="5.4 新生代调优"></a>5.4 新生代调优</h3><hr>
<ul>
<li><p>新生代的特点	（内存调优从新生代开始）</p>
<ul>
<li><p>所有的 new 操作的内存分配非常廉价</p>
<ul>
<li>TLAB thread-local allocation buffer  每个线程局部的私有的区域 进行伊甸园分配，线程安全</li>
</ul>
</li>
<li><p>死亡对象的回收代价是零  （新生代所有的垃圾回收器都是用的复制算法）</p>
</li>
<li><p>大部分对象用过即死 新生代中的</p>
</li>
<li><p>Minor GC 的时间远远低于 Full GC</p>
</li>
</ul>
</li>
</ul>
<p>策略：</p>
<ul>
<li>新生代调优加大容量 越大越好吗？</li>
</ul>
<p>-Xmn Sets the initial and maximum size (in bytes) of the heap for the young generation (nursery). GC is performed in this region more often than in other regions. If the size for the young generation is too small, then a lot of minor garbage collections are performed. If the size is too large, then only full garbage collections are performed, which can take a long time to complete. Oracle recommends that you keep the size for the young generation greater than 25% and less than 50% of the overall heap size.</p>
<p>新生代小了会频繁mGC 引发暂停   太大了 老年代的空间就少了，空间少的触发垃圾回收FullGC就多了</p>
<ul>
<li>新生代能容纳所有【并发量 * (请求-响应)】的数据</li>
<li>幸存区大到能保留【当前活跃对象+需要晋升对象】</li>
<li>晋升阈值配置得当，让长时间存活对象尽快晋升</li>
</ul>
<p>晋升阈值配置得当，让长时间存活对象尽快晋升</p>
<p>-XX:MaxTenuringThreshold&#x3D;threshold</p>
<p>-XX:+PrintTenuringDistribution</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Desired survivor size <span class="number">48286924</span> bytes, <span class="keyword">new</span> <span class="title class_">threshold</span> <span class="number">10</span> (max <span class="number">10</span>)</span><br><span class="line">- age <span class="number">1</span>: <span class="number">28992024</span> bytes, <span class="number">28992024</span> total</span><br><span class="line">- age <span class="number">2</span>: <span class="number">1366864</span> bytes, <span class="number">30358888</span> total</span><br><span class="line">- age <span class="number">3</span>: <span class="number">1425912</span> bytes, <span class="number">31784800</span> total</span><br><span class="line">..</span><br></pre></td></tr></table></figure>

<h3 id="5-5-老年代调优"><a href="#5-5-老年代调优" class="headerlink" title="5.5 老年代调优"></a>5.5 老年代调优</h3><hr>
<p>以 CMS 为例</p>
<ul>
<li>以 CMS 为例</li>
<li>先尝试不做调优，如果没有 Full GC 那么已经…，否则先尝试调优新生代</li>
<li>观察发生 Full GC 时老年代内存占用，将老年代内存预设调大 1&#x2F;4 ~ 1&#x2F;3<ul>
<li>-XX:CMSInitiatingOccupancyFraction&#x3D;percent</li>
</ul>
</li>
</ul>
<h3 id="5-6-案例"><a href="#5-6-案例" class="headerlink" title="5.6 案例"></a>5.6 案例</h3><hr>
<ul>
<li>案例1 Full GC 和 Minor GC频繁<ul>
<li>增大新生代空间，提高晋升阈值</li>
</ul>
</li>
<li>案例2 请求高峰期发生 Full GC，单次暂停时间特别长 （CMS）<ul>
<li>CMS处理过程中，重新标记所耗费的时间最长。</li>
<li>因为重新标记要扫描整个内存。所以重新扫描前先对新生代做一次垃圾回收可以减少扫描数量，降低时间</li>
</ul>
</li>
<li>案例3 老年代充裕情况下，发生 Full GC （CMS jdk1.7）<ul>
<li>1.7 方法区在永久代，永久代空间不足也会发生FullGC</li>
</ul>
</li>
</ul>

    </div>

    
    
    
        <div class="reward-container">
  <div>原创技术分享，您的支持将鼓励我继续创作</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="wFei 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="wFei 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>wFei
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://holdustogether.github.io/2022/08/22/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" title="JVM 垃圾回收">https://holdustogether.github.io/2022/08/22/JVM垃圾回收/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java/" rel="tag"># Java</a>
              <a href="/tags/JVM/" rel="tag"># JVM</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/08/22/JVM%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/" rel="prev" title="JVM内存结构">
      <i class="fa fa-chevron-left"></i> JVM内存结构
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/08/22/JVM%E7%B1%BB%E5%8A%A0%E8%BD%BD%E4%B8%8E%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/" rel="next" title="JVM类加载与字节码技术">
      JVM类加载与字节码技术 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E5%AF%B9%E8%B1%A1%E5%8F%AF%E4%BB%A5%E5%9B%9E%E6%94%B6"><span class="nav-number">1.</span> <span class="nav-text">1. 如何判断对象可以回收</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E6%B3%95"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 引用计数法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%8F%AF%E8%BE%BE%E6%80%A7%E5%88%86%E6%9E%90%E7%AE%97%E6%B3%95"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 可达性分析算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%9B%9B%E7%A7%8D%E5%BC%95%E7%94%A8"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 四种引用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">2. 垃圾回收算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 标记清除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%A0%87%E8%AE%B0%E6%95%B4%E7%90%86"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 标记整理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%A4%8D%E5%88%B6"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 复制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%88%86%E4%BB%A3%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="nav-number">3.</span> <span class="nav-text">3. 分代垃圾回收</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E7%9B%B8%E5%85%B3-VM-%E5%8F%82%E6%95%B0"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 相关 VM 参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8"><span class="nav-number">4.</span> <span class="nav-text">4. 垃圾回收器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E4%B8%B2%E8%A1%8C"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 串行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%90%9E%E5%90%90%E9%87%8F%E4%BC%98%E5%85%88"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 吞吐量优先</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4%E4%BC%98%E5%85%88-CMS"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 响应时间优先 CMS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-G1"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 G1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-G1-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E9%98%B6%E6%AE%B5"><span class="nav-number">4.4.1.</span> <span class="nav-text">1) G1 垃圾回收阶段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Young-Collection"><span class="nav-number">4.4.2.</span> <span class="nav-text">2) Young Collection</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Young-Collection-CM"><span class="nav-number">4.4.3.</span> <span class="nav-text">3) Young Collection + CM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-Mixed-Collection"><span class="nav-number">4.4.4.</span> <span class="nav-text">4) Mixed Collection</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-Full-GC"><span class="nav-number">4.4.5.</span> <span class="nav-text">5) Full GC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-Young-Collection-%E8%B7%A8%E4%BB%A3%E5%BC%95%E7%94%A8"><span class="nav-number">4.4.6.</span> <span class="nav-text">6) Young Collection 跨代引用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-Remark"><span class="nav-number">4.4.7.</span> <span class="nav-text">7) Remark</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-JDK-8u20-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8E%BB%E9%87%8D"><span class="nav-number">4.4.8.</span> <span class="nav-text">8) JDK 8u20 字符串去重</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-JDK-8u40-%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0%E7%B1%BB%E5%8D%B8%E8%BD%BD"><span class="nav-number">4.4.9.</span> <span class="nav-text">9) JDK 8u40 并发标记类卸载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-JDK-8u60-%E5%9B%9E%E6%94%B6%E5%B7%A8%E5%9E%8B%E5%AF%B9%E8%B1%A1"><span class="nav-number">4.4.10.</span> <span class="nav-text">10) JDK 8u60 回收巨型对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-JDK-9-%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0%E8%B5%B7%E5%A7%8B%E6%97%B6%E9%97%B4%E7%9A%84%E8%B0%83%E6%95%B4"><span class="nav-number">4.4.11.</span> <span class="nav-text">11) JDK 9 并发标记起始时间的调整</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-JDK-9-%E6%9B%B4%E9%AB%98%E6%95%88%E7%9A%84%E5%9B%9E%E6%94%B6"><span class="nav-number">4.4.12.</span> <span class="nav-text">12) JDK 9 更高效的回收</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E8%B0%83%E4%BC%98"><span class="nav-number">5.</span> <span class="nav-text">5. 垃圾回收调优</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E8%B0%83%E4%BC%98%E9%A2%86%E5%9F%9F"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 调优领域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E7%A1%AE%E5%AE%9A%E7%9B%AE%E6%A0%87"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 确定目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E6%9C%80%E5%BF%AB%E7%9A%84-GC"><span class="nav-number">5.3.</span> <span class="nav-text">5.3 最快的 GC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-%E6%96%B0%E7%94%9F%E4%BB%A3%E8%B0%83%E4%BC%98"><span class="nav-number">5.4.</span> <span class="nav-text">5.4 新生代调优</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-%E8%80%81%E5%B9%B4%E4%BB%A3%E8%B0%83%E4%BC%98"><span class="nav-number">5.5.</span> <span class="nav-text">5.5 老年代调优</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-%E6%A1%88%E4%BE%8B"><span class="nav-number">5.6.</span> <span class="nav-text">5.6 案例</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wFei"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">wFei</p>
  <div class="site-description" itemprop="description">不要停止成为更好的自己</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/holdustogether" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;holdustogether" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/wf1657885988@163.com" title="E-Mail → wf1657885988@163.com"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
	<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=450 src="//music.163.com/outchain/player?type=0&id=7614662893&auto=1&height=430"></iframe>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022.08 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wFei</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共53.7k字</span>
</div>

    <div>
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
    </div>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='128,136,147' opacity='0.8' zIndex='-1' count='150' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

  <!-- ҳ����С���� -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
